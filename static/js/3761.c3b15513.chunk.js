"use strict";(self.webpackChunkwanlok_component_react=self.webpackChunkwanlok_component_react||[]).push([[3761],{1420:(e,t,r)=>{r.d(t,{g:()=>c});var s=r(89379),i=r(35143),a=r(91967),l=r(34154),o=r(46053),n=(r(81806),r(76460),r(47249),r(85842)),y=r(68002),p=r(55053),h=r(46530),u=r(65419);const m={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let c=class extends a.A{constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const t=(0,h.f)(this.floors,e);return e.toExportImageJSON(t)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,u.Sk)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.removeHandles("layer"),e&&this.addHandles([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(m[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){var e;const t=!(null===(e=this.floors)||void 0===e||!e.length),r=this.visibleSublayers.filter((e=>null!=e.definitionExpression||t&&null!=e.floorInfo));return r.length?JSON.stringify(r.reduce(((e,t)=>{const r=(0,h.f)(this.floors,t),s=(0,l.m)(r,t.definitionExpression);return null!=s&&(e[t.id]=s),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,r=this.scale,s=t=>{t.visible&&(0===r||(0,y.zx)(r,t.minScale,t.maxScale))&&(t.sublayers?t.sublayers.forEach(s):e.unshift(t))};t&&t.forEach(s);const i=this._get("visibleSublayers");return!i||i.length!==e.length||i.some(((t,r)=>e[r]!==t))?e:i}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=(0,s.A)((0,s.A)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}};(0,i._)([(0,o.MZ)({readOnly:!0})],c.prototype,"dynamicLayers",null),(0,i._)([(0,o.MZ)()],c.prototype,"floors",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],c.prototype,"hasDynamicLayers",null),(0,i._)([(0,o.MZ)()],c.prototype,"layer",null),(0,i._)([(0,o.MZ)({readOnly:!0})],c.prototype,"layers",null),(0,i._)([(0,o.MZ)({readOnly:!0})],c.prototype,"layerDefs",null),(0,i._)([(0,o.MZ)({type:Number})],c.prototype,"scale",void 0),(0,i._)([(0,o.MZ)(p.ui)],c.prototype,"timeExtent",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],c.prototype,"version",null),(0,i._)([(0,o.MZ)({readOnly:!0})],c.prototype,"visibleSublayers",null),c=(0,i._)([(0,n.$)("esri.layers.mixins.ExportImageParameters")],c)},3761:(e,t,r)=>{r.r(t),r.d(t,{default:()=>m});var s=r(35143),i=(r(76460),r(81806),r(47249),r(50076),r(85842)),a=r(10183),l=r(46053),o=r(55053),n=r(1420);const y=e=>{let t=class extends e{initialize(){this.exportImageParameters=new n.g({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.floors)&&void 0!==e?e:null}get exportImageVersion(){var e;return null!==(e=this.exportImageParameters)&&void 0!==e&&e.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}canResume(){var e;return!!super.canResume()&&!(null!==(e=this.timeExtent)&&void 0!==e&&e.isEmpty)}};return(0,s._)([(0,l.MZ)()],t.prototype,"exportImageParameters",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],t.prototype,"floors",null),(0,s._)([(0,l.MZ)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,s._)([(0,l.MZ)()],t.prototype,"layer",void 0),(0,s._)([(0,l.MZ)()],t.prototype,"suspended",void 0),(0,s._)([(0,l.MZ)(o.ui)],t.prototype,"timeExtent",void 0),t=(0,s._)([(0,i.$)("esri.views.layers.MapImageLayerView")],t),t};var p=r(93080),h=r(55754);let u=class extends(y(a.A)){constructor(){super(...arguments),this.type="map-image-3d"}initialize(){this._updatingHandles.add((()=>this.exportImageVersion),(()=>this._updatingHandles.addPromise(this.refreshDebounced()))),this._popupHighlightHelper=new p.Uh({createFetchPopupFeaturesQueryGeometry:(e,t)=>(0,h.V)(e,t,this.view),layerView:this,updatingHandles:this._updatingHandles})}destroy(){var e;null===(e=this._popupHighlightHelper)||void 0===e||e.destroy()}fetchPopupFeaturesAtLocation(e,t){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(e,t)}getFetchOptions(){return{timeExtent:this.timeExtent}}};u=(0,s._)([(0,i.$)("esri.views.3d.layers.MapImageLayerView3D")],u);const m=u}}]);
//# sourceMappingURL=3761.c3b15513.chunk.js.map