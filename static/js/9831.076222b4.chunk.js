"use strict";(self.webpackChunkwanlok_component_react=self.webpackChunkwanlok_component_react||[]).push([[9831],{56567:(e,t,n)=>{n.d(t,{A:()=>f});var i=n(35143),r=(n(35238),n(23458)),s=n(69098),o=n(73582),a=n(42553),l=n(46053),c=n(21403),u=(n(47249),n(81806),n(85842)),d=n(40565),h=n(13904);let p=class extends((0,a.Te)(s.P)){constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=r.L.Direct,this.offset=0,this.orientation=0}};(0,i._)([(0,l.MZ)({type:["length"],json:{write:{isRequired:!0}}})],p.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:h.A,json:{write:!0}})],p.prototype,"startPoint",void 0),(0,i._)([(0,l.MZ)({type:h.A,json:{write:!0}})],p.prototype,"endPoint",void 0),(0,i._)([(0,l.MZ)({type:r.h,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"measureType",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"offset",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,c.w)((e=>o.ie.normalize((0,d.GB)(e),0,!0)))],p.prototype,"orientation",void 0),p=(0,i._)([(0,u.$)("esri.analysis.LengthDimension")],p);const f=p},23458:(e,t,n)=>{var i;n.d(t,{L:()=>i,h:()=>r}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(i||(i={}));const r=[i.Horizontal,i.Vertical,i.Direct]},28608:(e,t,n)=>{function i(){return new Float32Array(4)}function r(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,n,i){const r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}function o(){return i()}function a(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function u(){return s(0,0,1,0)}function d(){return s(0,0,0,1)}n.d(t,{fA:()=>s,o8:()=>r});const h=o(),p=a(),f=l(),_=c(),m=u(),v=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:v,UNIT_X:f,UNIT_Y:_,UNIT_Z:m,ZEROS:h,clone:r,create:i,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:s,ones:a,unitW:d,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},56002:(e,t,n)=>{function i(e){let t,n,i=[],r=!1;return function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return r&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(o,i)||(n=e.apply(this,o),t=this,i=o,r=!0),n}}n.d(t,{B:()=>i})},46530:(e,t,n)=>{function i(e){var t;const n=e.layer;return"floorInfo"in n&&null!==(t=n.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?s(e.view.floors,n.floorInfo.floorField):null}function r(e,t){var n;return"floorInfo"in t&&null!==(n=t.floorInfo)&&void 0!==n&&n.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(null===e||void 0===e||!e.length)return null;const n=e.filter((e=>""!==e)).map((e=>"'".concat(e,"'")));return n.push("''"),"".concat(t," IN (").concat(n.join(","),") OR ").concat(t," IS NULL")}n.d(t,{E:()=>i,f:()=>r})},69831:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ar});var i,r=n(35143),s=n(91967),o=n(54901),a=n(76460),l=n(30726),c=n(68134),u=n(46053),d=(n(81806),n(47249),n(85842)),h=n(2522),p=n(23458),f=n(31633),_=n(19747),m=n(15941),v=n(24648),g=n(34761),y=n(13191),S=n(20664),w=n(9392),M=n(5568),b=n(75762),P=n(18117),x=n(32535),O=n(25191),R=n(14487),C=n(80963),T=n(41868);function E(e,t,n){const r=D(e,t,n,i.Direct);return null!=r?(0,v.d_)(r.direct,r.unit):null}function A(e,t,n){const r=D(e,t,n,i.Horizontal);return null!=r?(0,v.d_)(r.horizontal,r.unit):null}function D(e,t,n,r){const s=(0,T.l)(n),o=(0,f._H)(s);if(null==o)return null;const a=t[2]-e[2];if(r===i.Vertical)return{verticalSigned:a,unit:o};if(!(0,R.F)(e,n,H,s)||!(0,R.F)(t,n,j,s))return null;if(r===i.Direct)return{direct:(0,S.q)(j,H),unit:o};if((0,S.s)(G,e[0],e[1],t[2]),!(0,R.F)(G,n,G,s))return null;const l=(0,S.q)(G,j);return r===i.Horizontal?{horizontal:l,unit:o}:{direct:(0,S.q)(j,H),horizontal:l,vertical:Math.abs(a),unit:o}}!function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(i||(i={}));const L=(0,w.vt)(),z=(0,w.vt)(),H=(0,w.vt)(),j=(0,w.vt)(),G=(0,w.vt)();n(35238);var V=n(63391);n(482);(0,w.vt)();var Z=n(98799),F=n(7137),k=n(90659),I=n(13312);function N(e,t,n){return(0,k.M)(n,q,X,U,e,t,n)}function q(e,t,n){return(0,v.d_)((0,F._3)(B,e,t,n).distance,"meters")}function X(e,t,n){return(0,v.d_)((0,V.geodesicLength)(function(e,t,n){return{type:"polyline",spatialReference:n,paths:[[[...e],[...t]]]}}(e,t,n),"meters"),"meters")}function U(e,t,n){return(0,Z.H)(e,n,Y)&&(0,Z.H)(t,n,Q)?(0,v.d_)((0,F._3)(B,Y,Q,I.A.WGS84).distance,"meters"):null}const B=new F.Zj,W=(0,w.vt)(),$=(0,w.vt)(),Y=(0,w.vt)(),Q=(0,w.vt)();function J(e,t){var n;return null!==(n=function(e,t){if(!(0,C.aI)(e.spatialReference,t.spatialReference))return null;const{spatialReference:n}=e;return W[0]=e.x,W[1]=e.y,W[2]=e.hasZ?e.z:0,$[0]=t.x,$[1]=t.y,$[2]=t.hasZ?t.z:0,N(W,$,n)}(e,t))&&void 0!==n?n:function(e,t){const{spatialReference:n}=e;return(0,C.aI)(n,t.spatialReference)?(L[0]=e.x,L[1]=e.y,L[2]=e.hasZ?e.z:0,z[0]=t.x,z[1]=t.y,z[2]=t.hasZ?t.z:0,A(L,z,n)):null}(e,t)}(0,w.vt)(),(0,w.vt)();function K(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,dimension:{offset:i,measureType:r,orientation:s}}=e;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,offset:i,measureType:r,orientation:s}}function ee(e,t){var n,i,r;let{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,offset:a,measureType:l,orientation:c}=e,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==s||null==o)return null;const d=re(null!==(n=null===u||void 0===u?void 0:u.directSegment)&&void 0!==n?n:new O.C,{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o},t),h=null!==(i=null===u||void 0===u?void 0:u.primaryOffsetAxis)&&void 0!==i?i:(0,w.vt)();ae(h,{measureType:l,elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,directSegment:d,orientation:c,renderCoordsHelper:t});const f=null!==(r=null===u||void 0===u?void 0:u.dimensionSegment)&&void 0!==r?r:new O.C;return ce({elevationAlignedStartPoint:s,elevationAlignedEndPoint:o})&&l===p.L.Vertical?((0,S.c)(f.startRenderSpace,d.startRenderSpace),(0,S.c)(f.endRenderSpace,d.endRenderSpace)):ue(f,{offsetAxis:h,offset:a,relativeToSegment:d,renderCoordsHelper:t}),{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,directSegment:d,dimensionSegment:f,primaryOffsetAxis:h,spatialReference:t.spatialReference}}function te(e,t,n,i){return t===ne.Start?((0,S.c)(e.startRenderSpace,n.startRenderSpace),(0,S.c)(e.endRenderSpace,i.startRenderSpace)):((0,S.c)(e.startRenderSpace,n.endRenderSpace),(0,S.c)(e.endRenderSpace,i.endRenderSpace)),e}var ne;function ie(e,t,n,i){switch(t){case p.L.Direct:return re(e,n,i);case p.L.Horizontal:case p.L.Vertical:{const{elevationAlignedStartPoint:r,elevationAlignedEndPoint:s,dimension:o,geometry:a}=n;let l;o.measureType===p.L.Direct?(l=function(e,t){const n=e.directSegment.eval(.5,b.rq.get()),i=t.worldUpAtPosition(n,b.rq.get()),r=e.dimensionSegment.eval(.5,b.rq.get()),s=(0,S.z)(b.rq.get(),r,n);return!(0,S.G)(s,w.uY)&&(0,S.k)(s,i)>0}(a,i)===r.z>s.z,t===p.L.Horizontal&&(l=!l)):l=!function(e){const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment,{startRenderSpace:i,endRenderSpace:r}=e.directSegment;return(0,S.w)(i,t)<(0,S.w)(r,n)}(a);const[c,u]=l?[r,s]:[s,r],d=(0,x.EL)(u,se);return t===p.L.Horizontal?d.z=c.z:(d.x=c.x,d.y=c.y),i.toRenderCoords(c,e.startRenderSpace),i.toRenderCoords(d,e.endRenderSpace),e}}}function re(e,t,n){return n.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),n.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(ne||(ne={}));const se=(0,P.T)(0,0,0,null);const oe=new O.C;function ae(e,t){const{measureType:n,elevationAlignedStartPoint:i,elevationAlignedEndPoint:r,directSegment:{startRenderSpace:s,endRenderSpace:o},directSegment:a,renderCoordsHelper:l}=t,c=a.eval(.5,b.rq.get()),u=l.worldUpAtPosition(c,b.rq.get()),d=l.worldBasisAtPosition(c,M._.Y,b.rq.get());switch(n){case p.L.Horizontal:(0,S.c)(e,u);break;case p.L.Vertical:(0,S.k)(s,u)<(0,S.k)(o,u)?(0,S.z)(e,o,s):(0,S.z)(e,s,o),(0,S.b)(e,e,u),(0,S.b)(e,e,u);break;case p.L.Direct:{var h;const n=null!==(h=t.orientation)&&void 0!==h?h:0;if(ce({elevationAlignedStartPoint:i,elevationAlignedEndPoint:r}))(0,g.$0)(le,-(0,m.kU)(n),u),(0,S.e)(e,d,le);else{const t=(0,S.z)(b.rq.get(),o,s),i=(0,S.b)(b.rq.get(),t,u);(0,S.b)(i,i,t),(0,g.$0)(le,(0,m.kU)(n),t),(0,S.e)(e,i,le)}break}}return(0,S.G)(e,w.uY)?(0,S.c)(e,d):(0,S.n)(e,e)}const le=(0,y.vt)();function ce(e){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n}=e;return null!=t&&null!=n&&t.x===n.x&&t.y===n.y}function ue(e,t){const{offsetAxis:n,offset:i,relativeToSegment:{startRenderSpace:r,endRenderSpace:s},relativeToSegment:o,renderCoordsHelper:a}=t,l=i/a.unitInMeters,[c,u]=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=(0,S.k)(t,n),s=(0,S.k)(e,n),o=Math.abs(r-s)+i;return r>s?[o,i]:[i,o]}(r,s,n,l);return(0,S.r)(e.startRenderSpace,o.startRenderSpace,n,c),(0,S.r)(e.endRenderSpace,o.endRenderSpace,n,u),e}function de(e,t,n){const i=t.directSegment.eval(.5,b.rq.get());return n.worldUpAtPosition(i,e)}function he(e,t){const{startRenderSpace:n,endRenderSpace:i}=t.directSegment;return(0,S.z)(e,i,n)}function pe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1};const{startRenderSpace:i,endRenderSpace:r}=t.dimensionSegment;return n.invert?(0,S.z)(e,i,r):(0,S.z)(e,r,i)}function fe(e,t){const n=e.directSegment.eval(.5,b.rq.get());return t.headingAtPosition(n,e.primaryOffsetAxis)}const _e=(0,w.vt)();function me(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n}=e;if(null==t||null==n)return!1;const i=function(e,t){const{spatialReference:n}=e;return(0,C.aI)(n,t.spatialReference)?(L[0]=e.x,L[1]=e.y,L[2]=e.hasZ?e.z:0,z[0]=t.x,z[1]=t.y,z[2]=t.hasZ?t.z:0,E(L,z,n)):null}(t,n);return null!=i&&(0,v.kM)(i,"meters").value>k.U}function ve(e){return null!=e.geometry}let ge=class extends s.A{constructor(e){super(e)}initialize(){const e=(0,c.LF)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._watchComputation(t)}));this.addHandles((0,o.DQ)(e))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,_.c)(this.view)}_watchComputation(e){return(0,c.wB)((()=>K(e)),(t=>{const{measureType:n}=t;if(me(t)&&n!==p.L.Direct){const t=Math.round((0,f.oU)(k.U,"meters","kilometers"));return a.A.getLogger(this).warnOnce("A ".concat(n," dimension in the analysis (id: '").concat(this.analysis.id,"') will not display, because only direct dimensions can measure lengths greater than ").concat(t,' km. Update the measureType of the affected dimension to "direct" to display it.')),void(e.geometry=null)}const i=ee(t,this.view.renderCoordsHelper,e.geometry);e.geometry=i,e.result.length=function(e,t,n){if(null==e)return null;let i;if(t===p.L.Horizontal)i=J(e.elevationAlignedStartPoint,e.elevationAlignedEndPoint);else{const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment;i=E(t,n,e.spatialReference)}if(null==i)return null;const r=t===p.L.Vertical?(0,f.jE)(i.value,i.unit,n):(0,f.Vs)(i.value,i.unit,n);return(0,v.kM)(i,r)}(i,n,this._defaultUnit)}),c.pc)}};(0,r._)([(0,u.MZ)({constructOnly:!0})],ge.prototype,"analysisViewData",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],ge.prototype,"view",void 0),(0,r._)([(0,u.MZ)()],ge.prototype,"analysis",null),(0,r._)([(0,u.MZ)()],ge.prototype,"_defaultUnit",null),ge=(0,r._)([(0,d.$)("esri.views.3d.analysis.Dimension.support.DimensionController")],ge);var ye=n(50176),Se=n(69539),we=n(73582),Me=n(76931),be=n(55855),Pe=n(13927),xe=n(59784);function Oe(e){return(0,xe._L)(e.accentColor,.5)}function Re(e){return(0,xe.bJ)(e.accentColor)}const Ce=new Se.A([127,127,127,.5]),Te=6,Ee=5;var Ae=n(56121),De=n(38317),Le=n(91175),ze=n(7947),He=n(99443),je=n(50468),Ge=n(51799),Ve=n(62577),Ze=n(45463),Fe=n(66470),ke=n(77447),Ie=n(425),Ne=n(70825),qe=n(76336),Xe=n(13904);class Ue{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find((t=>this.hasOwnProperty(t)&&e===this[t]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of p.h)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case p.L.Direct:return this.direct;case p.L.Horizontal:return this.horizontal;case p.L.Vertical:return this.vertical}}}class Be extends Ae.q{constructor(e,t){const n=(0,De.UM)(Se.A.toUnitRGBA(Oe(e.effectiveTheme))),i=[new Le.M((0,Ve.CM)(n,1,32,32),ut)];super({view:e,renderObjects:i,metadata:t.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,c.wB)((()=>({color:Se.A.toUnitRGBA(Oe(e.effectiveTheme))})),(e=>n.setParameters(e)))}destroy(){this._themeHandle.remove(),super.destroy()}}class We extends Ae.q{constructor(e,t){let{lineSizePt:n,material:i,metadata:r}=t;super({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:r}),this._options={calloutColor:(0,be.vt)(),lineSizePt:n,material:i},this._themeHandle=(0,c.wB)((()=>Se.A.toUnitRGBA(Oe(e.effectiveTheme))),(e=>{this._options.calloutColor=e,ct(this,$e({...this._options,metadata:this.metadata}))}),c.Vh)}update(e){let{lineSizePt:t,material:n}=e;this._options.lineSizePt=t,this._options.material=n,ct(this,$e({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function $e(e){let{calloutColor:t,lineSizePt:n,material:i,metadata:r}=e;return{calloutLength:.25*He.PV*.8*(0,Me.Lz)(n)+18,calloutColor:t,calloutWidth:2,customStateMask:ut,discScale:.3,focusMultiplier:2,material:i,metadata:r}}function Ye(e,t){let{computation:n,view:i}=t;return[(0,Ne.Xt)(e,((e,t,r)=>{Qe({cancel:r,computation:n,settingHeading:!1,steps:t,view:i})})),e.events.on("immediate-click",(e=>{!function(e,t,n){const{dimension:i,geometry:r}=t;if(90===i.orientation||270===i.orientation)return i.orientation=0,void e.stopPropagation();if(null==r)return;const{renderCoordsHelper:s}=n,o=ee({...K(t),orientation:90},s),a=ee({...K(t),orientation:270},s);if(null==o||null==a)return;const l=fe(o,s),c=fe(a,s),u=et(r,n),d=we.ie.shortestSignedDiff(u,l),h=we.ie.shortestSignedDiff(u,c);i.orientation=Math.abs(d)<Math.abs(h)?90:270,e.stopPropagation()}(e,n,i)}))]}function Qe(e){var t,n;const{cancel:i,computation:r,settingHeading:s,steps:o,view:a}=e;if(!ve(r))return;const{renderCoordsHelper:l}=a,{dimension:c,geometry:u}=r,d=(0,w.vt)(),h=rt((0,w.vt)(),u,u.directSegment,l),p=st(b.rq.get(),{forHeading:s,geometry:u,renderCoordsHelper:l}),f=(0,Pe.O_)(h,p,(0,Pe.vt)()),_=s?null!==(t=c.orientation)&&void 0!==t?t:fe(u,a.renderCoordsHelper):null!==(n=c.orientation)&&void 0!==n?n:0;o.next((0,ze.AA)(a,f)).next((e=>{"start"===e.action&&(0,S.c)(d,e.renderStart);const t=(0,Pe.Qj)(f),n=(0,De.FY)(d,e.renderEnd,h,t);let i=_-(0,m.KJ)(n);s||(i=function(e){const t=we.ie.normalize(e)%90;return t<Ee?e-t:90-t<Ee?e+(90-t):e}(i)),c.orientation=i})),i.next((0,Ne.VG)(c,["orientation"]))}function Je(e,t){let{computation:n,manipulatorMeasureType:i,view:r}=t,s=p.L.Direct,o=0,a=0;return[e.events.on("grab-changed",(t=>{if("start"!==t.action||!ve(n))return;const{dimension:l,geometry:c}=n;s=l.measureType,o=l.offset,a=l.orientation;const u=(0,S.c)(b.rq.get(),e.renderLocation);l.measureType=i,l.offset=function(e,t,n,i){const{directSegment:r}=n,s=ae(b.rq.get(),{measureType:t,directSegment:r,renderCoordsHelper:i}),o=ue(oe,{offsetAxis:s,offset:0,relativeToSegment:r,renderCoordsHelper:i}).eval(.5,b.rq.get()),a=(0,S.z)(b.rq.get(),e,o);return(0,S.k)(a,s)*i.unitInMeters}(u,i,c,r.renderCoordsHelper),l.orientation=0})),(0,Ne.Xt)(e,((e,t,l)=>{if(!ve(n))return;const{geometry:c,dimension:u}=n,{renderCoordsHelper:d}=r,h=ie(ft,i,n,d),p=ae(b.rq.get(),{measureType:i,directSegment:c.directSegment,renderCoordsHelper:d}),f=(0,ze.z7)(e);t.next(f).next(Ke(r,u,h,p)),l.next(f).next((e=>(u.measureType=s,u.offset=o,u.orientation=a,e)))}))]}function Ke(e,t,n,i){const r=(0,S.f)(b.rq.get(),n.endRenderSpace,n.startRenderSpace);(0,S.b)(r,r,i);const s=(0,Pe.O_)(n.startRenderSpace,r,(0,Pe.vt)()),o=(0,Pe.O_)(n.startRenderSpace,i,(0,Pe.vt)()),a=t.offset;let l,c=0;const u=new Ne.rh;return u.next((0,ze.AA)(e,s)).next((n=>{"start"===n.action&&(c=(0,Pe.mN)(o,n.renderStart));const i=((0,Pe.mN)(o,n.renderEnd)-c)*e.renderCoordsHelper.unitInMeters;t.offset=a+i,l=n})),e=>(u.execute(e),l)}function et(e,t){const{directSegment:n}=e,{renderCoordsHelper:i}=t,r=de(b.rq.get(),e,i),s=he(b.rq.get(),e),o=(0,S.b)(b.rq.get(),s,r),{viewForward:a}=t.state.camera;(0,S.k)(o,a)>0&&(0,S.h)(o,o,-1);const l=n.eval(.5,b.rq.get());return i.headingAtPosition(l,o)}function tt(e,t,n,i){let{forHeading:r}=i;const{dimension:s,geometry:o}=t,{primaryOffsetAxis:a}=o,l=(0,S.h)(nt,a,s.offset>=0?1:-1),c=st(it,{forHeading:r,geometry:o,renderCoordsHelper:n});(0,S.b)(c,c,l);const u=(0,De.wQ)(l,c,w.uY,pt);e.modelTransform=u,e.renderLocation=rt(dt,o,o.dimensionSegment,n)}const nt=(0,w.vt)(),it=(0,w.vt)();function rt(e,t,n,i){const{startRenderSpace:r,endRenderSpace:s}=n,o=function(e,t){const n=he(ot,e),i=de(at,e,t);return(0,S.k)(n,i)>0}(t,i)?r:s;return(0,S.c)(e,o)}function st(e,t){let{forHeading:n,geometry:i,renderCoordsHelper:r}=t;return n?de(e,i,r):pe(e,i,{invert:!0})}const ot=(0,w.vt)(),at=(0,w.vt)();function lt(e){return(0,Me.Lz)(e)+Te}function ct(e,t){var n,i,r,s,o,a,l;const c=null!==(n=t.material)&&void 0!==n?n:new ke.r({transparent:!0,writeDepth:!1,textureId:null===(i=t.texture)||void 0===i?void 0:i.id,renderOccluded:Ze.m$.Opaque,isDecoration:!0}),u=null!==(r=t.focusMultiplier)&&void 0!==r?r:De.eO.focusMultiplier,d=null!==(s=t.calloutLength)&&void 0!==s?s:De.eO.calloutLength,h=De.eO.discRadius*(null!==(o=t.discScale)&&void 0!==o?o:1),p=h*u,f=(e,t)=>{const n=[0,1,2,2,3,0];return new Ge.V(t,[[Fe.r.POSITION,new je.n([d-e,-e,0,d+e,-e,0,d+e,e,0,d-e,e,0],n,3,!0)],[Fe.r.UV0,new je.n([0,0,1,0,1,1,0,1],n,2,!0)]])},_=null!==(a=t.calloutWidth)&&void 0!==a?a:De.eO.calloutWidth,m=new Ie.W({width:_,color:t.calloutColor,renderOccluded:Ze.m$.OccludeAndTransparent,isDecoration:!0}),v=(0,Ve.Z8)(m,[[0,0,0],[d-h,0,0]]),g=(0,Ve.Z8)(m,[[0,0,0],[d-p,0,0]]),y=null!==(l=t.customStateMask)&&void 0!==l?l:qe.SJ.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[d,0,0]},e.focusMultiplier=u,e.metadata=t.metadata,e.radius=h,e.renderObjects=[new Le.M(f(h,c),qe.p7.Unfocused|y),new Le.M(v,qe.p7.Unfocused|y),new Le.M(f(p,c),qe.p7.Focused|y),new Le.M(g,qe.p7.Focused|y)]}const ut=qe.SJ.Custom1,dt=(0,w.vt)(),ht=(0,w.vt)(),pt=(0,y.vt)(),ft=new O.C;var _t,mt=n(56567),vt=n(88321),gt=n(53084),yt=n(56002),St=n(50346),wt=n(19451);function Mt(e,t,n){const{constraint:i,elevationAlignedStartPoint:r,elevationAlignedEndPoint:s,unconstrainedGeometry:o,view:a}=n,{dimension:l,previousConstraint:c,preConstraintProperties:u}=e;if(null==r||null==s)return;const d=()=>{"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if(null==i)d(),null!=c&&null!=u&&(l.measureType=u.measureType,l.orientation=u.orientation);else switch(l.measureType=p.L.Direct,i){case _t.Horizontal:if(i!==c&&(l.orientation=0),"startPoint"in t){const e=t.startPoint;null!=e&&(e.z=s.z),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.z=r.z),l.endPoint=e}break;case _t.Vertical:if(i!==c&&(l.orientation=et(o,a)),"startPoint"in t){const e=t.startPoint;null!=e&&(e.x=s.x,e.y=s.y),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.x=r.x,e.y=r.y),l.endPoint=e}break;case _t.Direct:i!==c&&null!=u&&(l.orientation=u.orientation),d()}e.previousConstraint=i,e.unconstrainedGeometry=o}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(_t||(_t={}));var bt=n(59962),Pt=n(12482),xt=n(43047),Ot=n(28608),Rt=n(49595),Ct=n(4763),Tt=n(44230),Et=n(95925),At=n(85746),Dt=n(99469),Lt=n(33169),zt=n(442);class Ht extends At.X{constructor(e){super(e),this._ray=(0,Et.vt)(),this._isWorldDown=!1,this._start=(0,w.vt)(),this._end=(0,w.fA)(1,0,0),this._width=1,this._color=(0,Ot.fA)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,Ot.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=Ft.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Ze.m$.OccludeAndTransparent,this._fadedExtensions=It,this._laserline=new Dt.o({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,S.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,S.f)(this._end,e,this._end),(0,Et.Cr)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,S.j)(this._start,e)||((0,S.c)(this._start,e),(0,Et.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,S.j)(this._end,e)||((0,S.c)(this._end,e),(0,Et.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,xt.a)(e,this._color)||((0,xt.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,xt.a)(e,this._innerColor)||((0,xt.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,xt.a)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,Ot.o8)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Ze.m$.OccludeAndTransparentStencil?Ze.m$.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=null!==e&&void 0!==e?e:It,this.recreateGeometry()}_updateMaterial(){var e,t;const{materialParameters:n}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(n),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(n)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new Ie.W(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const i=this._createGeometry(e);n.push(i),t.addGeometry(i),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Ie.W(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new zt.$(t)}_createGeometry(e){const t=this.extensionType===Ft.FADED,n=t?[(0,w.vt)(),(0,w.vt)(),(0,w.vt)(),(0,w.vt)()]:[(0,w.vt)(),(0,w.vt)()];return(0,Ve.Z8)(e,n,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===Ft.FADED?this._updateLineSegmentFinite(Zt):this._updateLineSegmentInfinite(this._extensionType,Zt)}_updateLineSegmentFinite(e){return(0,Tt.Cr)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const n=this.view.state.camera;switch((0,Rt.$e)(this._ray,jt),e){case Ft.LINE:jt.c0=-Number.MAX_VALUE;break;case Ft.RAY:case Ft.GROUND_RAY:{var i;const e=this._ray.origin,t=null!==(i=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"))&&void 0!==i?i:0,n=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&n<t&&(0,S.F)(jt.ray.direction,jt.ray.direction),this._extensionType===Ft.GROUND_RAY&&null!=t&&(jt.c1=Math.abs(n-t));break}}if(!(0,Ct.ig)(n.frustum,jt))return this._updateLineSegmentFinite(t);const r=(0,Rt.j1)(jt,Gt),s=(0,Rt.mO)(jt,Vt);return(0,Tt.Cr)(r,s,t)}_updateVertexAttributesObject3D(e,t){var n;const i=null===(n=e.geometries[0].getMutableAttribute(Fe.r.POSITION))||void 0===n?void 0:n.data;if(!i)return;let r=0;for(const s of this._lineVertices(t))i[r++]=s[0],i[r++]=s[1],i[r++]=s[2];e.geometryVertexAttributeUpdated(e.geometries[0],Fe.r.POSITION)}_updateVertexAttributesDraped(e,t){var n;const i=null===(n=e.getMutableAttribute(Fe.r.POSITION))||void 0===n?void 0:n.data;if(!i)return;let r=0;for(const s of this._lineVertices(t))i[r++]=s[0],i[r++]=s[1],i[r++]=Lt.bi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===Ft.FADED?(yield(0,Tt.sd)(e,-this.fadedExtensions.start,Gt),yield(0,Tt.sd)(e,0,Gt),yield(0,Tt.sd)(e,1,Gt),yield(0,Tt.sd)(e,1+this.fadedExtensions.end,Gt)):(yield(0,Tt.sd)(e,0,Gt),yield(0,Tt.sd)(e,1,Gt))}}const jt=(0,Rt.vt)(),Gt=(0,w.vt)(),Vt=(0,w.vt)(),Zt=(0,Tt.vt)();var Ft;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(Ft||(Ft={}));const kt=1/3,It={start:kt,end:kt};var Nt=n(19555),qt=n(72745);class Xt extends At.X{constructor(e){super(e),this._location=(0,w.vt)(),this._direction=(0,w.fA)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,Ot.fA)(1,0,1,1),this._renderOccluded=Ze.m$.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,S.j)(this._location,e)||((0,S.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,S.j)(this._direction,e)||((0,S.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,S.n)(this._direction,(0,S.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,xt.a)(e,this._color)||((0,xt.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new Ie.W(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const[i,r]=this._createGeometries(e);t.addGeometry(i),t.addGeometry(r),n.push(i),n.push(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Ie.W(this.materialParameters),t=(0,c.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new zt.$(e)))}_createGeometries(e){return[(0,Ve.Z8)(e,[(0,w.vt)(),(0,w.vt)()]),(0,Ve.Z8)(e,[(0,w.vt)(),(0,w.vt)()])]}_updateMaterial(){var e,t;const{materialParameters:n}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(n),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(n)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,Yt),(0,S.g)(Ut,this.location,this.direction),t.projectToScreen(Ut,Qt),(0,Nt.S8)(Qt,(0,Nt.Re)(Qt,Qt,Yt)),this._updateVertexAttributesObject3D(t,e,0,Yt,Qt,1),this._updateVertexAttributesObject3D(t,e,1,Yt,Qt,-1)}_updateVertexAttributesObject3D(e,t,n,i,r,s){var o;const a=t.geometries[n],l=null===(o=a.getMutableAttribute(Fe.r.POSITION))||void 0===o?void 0:o.data;if(!l)return;const{start:c,end:u}=this._computeStartEnd(r,i,s,this.offset,this.width,this.length);e.unprojectFromScreen((0,Me.PR)(c),Ut),l[0]=Ut[0],l[1]=Ut[1],l[2]=Ut[2],e.unprojectFromScreen((0,Me.PR)(u),Ut),l[3]=Ut[0],l[4]=Ut[1],l[5]=Ut[2],t.geometryVertexAttributeUpdated(a,Fe.r.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{location:i,width:r,length:s,offset:o}=this,a=Jt;a.spatialReference=t.renderer.spatialReference,a.x=i[0],a.y=i[1];const l=this.view.overlayPixelSizeInMapUnits(a)*n,c=r*l,u=s*l,d=o*l;this._updateVertexAttributesDraped(e[0],c,u,d,-1),this._updateVertexAttributesDraped(e[1],c,u,d,1)}_updateVertexAttributesDraped(e,t,n,i,r){var s;const o=null===(s=e.getMutableAttribute(Fe.r.POSITION))||void 0===s?void 0:s.data;if(!o)return;const{location:a,direction:l}=this,{start:c,end:u}=this._computeStartEnd(l,a,r,i,t,n);o[0]=c[0],o[1]=c[1],o[2]=Lt.bi,o[3]=u[0],o[4]=u[1],o[5]=Lt.bi,e.invalidateBoundingInfo()}_computeStartEnd(e,t,n,i,r,s){const o=(0,Nt.hs)(Bt,(0,Nt.hZ)(Bt,e[1]*n,e[0]*-n),i+r/2),a=(0,Nt.WQ)(Wt,(0,Nt.WQ)(Wt,(0,Nt.WQ)(Wt,t,(0,Nt.hs)(Wt,e,s/2)),o),o);return{start:a,end:(0,Nt.WQ)($t,a,(0,Nt.hs)($t,e,-s))}}}const Ut=(0,w.vt)(),Bt=(0,qt.vt)(),Wt=(0,qt.vt)(),$t=(0,qt.vt)(),Yt=(0,Me.gs)(),Qt=(0,Me.gs)(),Jt=(0,P.T)(0,0,void 0,null);var Kt=n(83574),en=n(47996),tn=n(57662),nn=n(23862),rn=n(42553);let sn=class extends rn.oY{constructor(){super(...arguments),this.enabled=!0}};(0,r._)([(0,u.MZ)({type:Boolean})],sn.prototype,"enabled",void 0),sn=(0,r._)([(0,d.$)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],sn);let on=class extends rn.oY{constructor(e){super(e),this.lineSnapper=new sn,this.parallelLineSnapper=new sn,this.rightAngleSnapper=new sn,this.rightAngleTriangleSnapper=new sn,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Se.A([255,127,0]),this.orangeTransparent=new Se.A([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,r._)([(0,u.MZ)({type:sn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],on.prototype,"lineSnapper",void 0),(0,r._)([(0,u.MZ)({type:sn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],on.prototype,"parallelLineSnapper",void 0),(0,r._)([(0,u.MZ)({type:sn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],on.prototype,"rightAngleSnapper",void 0),(0,r._)([(0,u.MZ)({type:sn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],on.prototype,"rightAngleTriangleSnapper",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],on.prototype,"shortLineThreshold",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],on.prototype,"distance",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],on.prototype,"pointThreshold",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],on.prototype,"intersectionParallelLineThreshold",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],on.prototype,"parallelLineThreshold",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],on.prototype,"verticalLineThresholdMeters",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],on.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],on.prototype,"pointOnLineThreshold",void 0),(0,r._)([(0,u.MZ)({type:Se.A,nonNullable:!0})],on.prototype,"orange",void 0),(0,r._)([(0,u.MZ)({type:Se.A,nonNullable:!0})],on.prototype,"orangeTransparent",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],on.prototype,"lineHintWidthReference",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],on.prototype,"lineHintWidthTarget",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],on.prototype,"lineHintFadedExtensions",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],on.prototype,"parallelLineHintWidth",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],on.prototype,"parallelLineHintLength",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],on.prototype,"parallelLineHintOffset",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],on.prototype,"rightAngleHintSize",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],on.prototype,"rightAngleHintOutlineSize",void 0),(0,r._)([(0,u.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],on.prototype,"satisfiesConstraintScreenThreshold",void 0),on=(0,r._)([(0,d.$)("esri.views.interactive.snapping.Settings.Defaults")],on);const an=new on;var ln=n(99791),cn=n(9730),un=n(64753);class dn extends un.m{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:ln.n.ALL),this.intersectionPoint=e}equals(e){return e instanceof dn&&(0,S.j)(this.intersectionPoint,e.intersectionPoint)}}var hn=n(23543);class pn extends un.m{constructor(e,t,n){super(n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:ln.n.ALL),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof pn&&(0,S.j)(this.lineStart,e.lineStart)&&(0,S.j)(this.lineEnd,e.lineEnd)}}var fn=n(23241);class _n extends un.m{constructor(e,t,n,i){super(i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:ln.n.ALL),this.previousVertex=e,this.centerVertex=t,this.nextVertex=n}equals(e){return e instanceof _n&&(0,S.j)(this.previousVertex,e.previousVertex)&&(0,S.j)(this.centerVertex,e.centerVertex)&&(0,S.j)(this.nextVertex,e.nextVertex)}}class mn{draw(e,t){const n=this._getUniqueHints(e),i=this.sortUniqueHints(n),r=[];for(const s of i)s instanceof dn&&r.push(this.visualizeIntersectionPoint(s,t)),s instanceof hn.c&&r.push(this.visualizeLine(s,t)),s instanceof pn&&r.push(this.visualizeParallelSign(s,t)),s instanceof _n&&r.push(this.visualizeRightAngleQuad(s,t)),s instanceof fn._&&r.push(this.visualizePoint(s,t));return(0,o.vE)(r)}sortUniqueHints(e){return e}_getUniqueHints(e){const t=[];for(const n of e){let e=!0;for(const i of t)if(n.equals(i)){e=!1;break}e&&t.push(n)}return t}}var vn=n(17072);class gn extends mn{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof hn.c?t.length:0)-(e instanceof hn.c?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:n,view:i}=t,r=yn(t);return(0,o.DQ)(new Kt.l({view:i,primitive:"circle",geometry:(0,nn.io)(e.intersectionPoint,n),elevationInfo:e.isDraped?Pt.Tq:Pt.qt,size:20,outlineSize:2,color:r.intersectionPointColor,outlineColor:r.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:n,spatialReference:i}=t,r=yn(t),s=Sn(e.point,e.domain,t);return(0,o.DQ)(new Kt.l({view:n,primitive:"circle",geometry:(0,nn.io)(s,i),elevationInfo:wn(e,t),size:20,outlineSize:2,color:r.pointColor,outlineColor:r.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:n,spatialReference:i}=t,r=yn(t),s=Sn(e.lineStart,e.domain,t),a=Sn(e.lineEnd,e.domain,t);return(0,o.DQ)(this._createLineSegmentHint(e.type,s,a,i,wn(e,t),n,r,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:n,spatialReference:i}=t,r=yn(t),{isDraped:s}=e,a=wn(e,t),l=Sn(e.lineStart,e.domain,t),c=Sn(e.lineEnd,e.domain,t),u=bn(l,i,a,n,s),d=bn(c,i,a,n,s),h=(0,S.m)(d,u,d,.5),p=new Xt({view:n,attached:!1,offset:an.parallelLineHintOffset,length:an.parallelLineHintLength,width:an.parallelLineHintWidth,color:r.parallelSignColor,location:h,renderOccluded:s?Ze.m$.OccludeAndTransparent:Ze.m$.Opaque,isDraped:s,renderGroup:tn.O7.SnappingHint,isDecoration:!0});return p.setDirectionFromPoints(u,h),p.attached=!0,(0,o.DQ)(p)}visualizeRightAngleQuad(e,t){const{view:n,spatialReference:i}=t,r=yn(t),s=wn(e,t),{isDraped:a}=e,l=Sn(e.previousVertex,e.domain,t),c=Sn(e.centerVertex,e.domain,t),u=Sn(e.nextVertex,e.domain,t),d=bn(l,i,s,n,a),h=bn(c,i,s,n,a),p=bn(u,i,s,n,a);return(0,o.DQ)(new en.n({view:n,attached:!0,color:a?r.rightAngleColorDraped:r.rightAngleColor,renderOccluded:a?Ze.m$.OccludeAndTransparent:Ze.m$.Transparent,outlineRenderOccluded:a?Ze.m$.OccludeAndTransparent:Ze.m$.Opaque,outlineColor:r.rightAngleOutlineColor,outlineSize:an.rightAngleHintOutlineSize,size:an.rightAngleHintSize,isDraped:a,geometry:{previous:d,center:h,next:p},renderGroup:tn.O7.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,n,i,r,s,o){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const u=bn(t,i,r,s,a),d=bn(n,i,r,s,a),h=new Ht({view:s,extensionType:Ft.FADED,start:u,end:d,isDraped:a,color:o.lineColor,renderOccluded:a?Ze.m$.OccludeAndTransparent:Ze.m$.Opaque,renderGroup:tn.O7.SnappingHint,isDecoration:!0});switch(e){case cn.H3.TARGET:h.width=an.lineHintWidthTarget,h.fadedExtensions={start:0,end:an.lineHintFadedExtensions};break;case cn.H3.REFERENCE_EXTENSION:h.width=an.lineHintWidthReference,h.fadedExtensions={start:0,end:0};break;case cn.H3.REFERENCE:h.width=an.lineHintWidthReference,h.fadedExtensions={start:l?an.lineHintFadedExtensions:0,end:c?an.lineHintFadedExtensions:0}}return h.attached=!0,h}}function yn(e){const{effectiveTheme:t}=e.view,n=Se.A.toUnitRGBA(t.accentColor),i=[0,0,0,0];return{intersectionPointColor:i,intersectionPointOutlineColor:n,pointColor:i,pointOutlineColor:n,lineColor:n,lineOutlineColor:void 0,parallelSignColor:n,rightAngleColor:n,rightAngleColorDraped:Se.A.toUnitRGBA((0,xe._L)(t.accentColor,.5)),rightAngleOutlineColor:n}}function Sn(e,t,n){const i=Mn(t,n);return null==i?e:(0,nn.vt)(e[0],e[1],i)}function wn(e,t){return null!=Mn(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?Pt.Tq:Pt.qt}function Mn(e,t){let{selfSnappingZ:n}=t;return e===ln.n.SELF&&null!=n?n.value:null}function bn(e,t,n,i,r){const s=(0,w.vt)();if(r){const n=i.basemapTerrain.overlayManager.renderer.spatialReference;(0,R.F)(e,t,s,n)}else(0,vn.XG)(e,t,n,i,s);return s}var Pn=n(7256),xn=n(32314),On=n(49296),Rn=n(44815),Cn=n(67425);var Tn=n(83490),En=n(84294);class An extends xn.X{constructor(e){super(e),this.view=null,this._renderOccluded=Ze.m$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,be.ci)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,be.ci)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,xt.a)(e,this._color)||((0,xt.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,xt.a)(e,this._outlineColor)||((0,xt.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,n,i,r){const s=(0,Rn.jh)(3*e.length),o=(0,Rn.jh)(s.length);e.forEach(((e,t)=>{s[3*t]=e[0],s[3*t+1]=e[1],s[3*t+2]=e.length>2?e[2]:0}));const a=(0,Cn.au)(s,t,0,o,0,s,0,s.length/3,n,i,r),l=null!=a;return{numVertices:e.length,position:s,mapPositions:o,projectionSuccess:l,sampledElevation:a}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,On.F.fromElevationInfo(this.elevationInfo)),n=[],i=t.numVertices,r=t.position;for(let s=0;s<i;++s){const e=(0,S.s)(Dn,r[3*s],r[3*s+1],r[3*s+2]),t=Ln(this._vertexMaterial,.5,e),i=Ln(this._vertexOutlineMaterial,.5,e);n.push({vertexGeometry:t,vertexOutlineGeometry:i})}return n}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:n,vertexOutlineGeometry:i}of t)e.addGeometry(n),e.addGeometry(i)}createExternalResources(){this._vertexMaterial=new En.A({...this._vertexMaterialParameters,writeDepth:!0,cullFace:Tn.s2.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new En.A({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:Tn.s2.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const Dn=(0,w.vt)();function Ln(e,t,n){return(0,Ve.CM)(e,t,16,16,{offset:n})}var zn=n(35925),Hn=n(89238),jn=n(974),Gn=n(39612),Vn=n(77944),Zn=n(19276);let Fn=class extends s.A{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new Zn.A}};(0,r._)([(0,u.MZ)({constructOnly:!0})],Fn.prototype,"layer",void 0),(0,r._)([(0,u.MZ)()],Fn.prototype,"enabled",void 0),(0,r._)([(0,u.MZ)()],Fn.prototype,"updating",void 0),(0,r._)([(0,u.MZ)()],Fn.prototype,"availability",void 0),(0,r._)([(0,u.MZ)()],Fn.prototype,"sublayerSources",void 0),Fn=(0,r._)([(0,d.$)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Fn);const kn=Fn;var In=n(18690);let Nn=class extends s.A{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new Zn.A,this.distance=an.distance,this.touchSensitivityMultiplier=an.touchSensitivityMultiplier,this.constraintsActive=!1}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var e,t,n;const i=this.featureSources;i.some(Xn)&&a.A.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const r=i.filter(Bn),s=null!==(e=null===(t=this._get("_effectiveFeatureSources"))||void 0===t?void 0:t.filter(Xn))&&void 0!==e?e:new Zn.A;for(const a of r){const e=s.find((e=>e.layer===a.layer.parent));if(e)e.sublayerSources.includes(a)||e.sublayerSources.add(a);else if(a.layer.parent){const e=new kn({layer:a.layer.parent});e.sublayerSources.add(a),s.add(e)}}for(const a of s){const e=a.sublayerSources.filter((e=>!r.includes(e)));a.sublayerSources.removeMany(e)}s.removeMany(s.filter((e=>0===e.sublayerSources.length)));const o=i.filter(Un),l=null!==(n=this._get("_effectiveFeatureSources"))&&void 0!==n?n:new Zn.A,{added:c,removed:u}=(0,In.iv)(l.toArray(),[...o,...s]);return l.removeMany(u),l.addMany(c),l}};(0,r._)([(0,u.MZ)()],Nn.prototype,"enabled",void 0),(0,r._)([(0,u.MZ)()],Nn.prototype,"enabledToggled",void 0),(0,r._)([(0,u.MZ)()],Nn.prototype,"forceDisabled",void 0),(0,r._)([(0,u.MZ)()],Nn.prototype,"selfEnabled",void 0),(0,r._)([(0,u.MZ)()],Nn.prototype,"featureEnabled",void 0),(0,r._)([(0,u.MZ)({type:Zn.A.ofType(kn)})],Nn.prototype,"featureSources",void 0),(0,r._)([(0,u.MZ)()],Nn.prototype,"distance",void 0),(0,r._)([(0,u.MZ)()],Nn.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,u.MZ)()],Nn.prototype,"constraintsActive",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],Nn.prototype,"effectiveEnabled",null),(0,r._)([(0,u.MZ)({readOnly:!0})],Nn.prototype,"effectiveSelfEnabled",null),(0,r._)([(0,u.MZ)({readOnly:!0})],Nn.prototype,"effectiveFeatureEnabled",null),(0,r._)([(0,u.MZ)({readOnly:!0})],Nn.prototype,"_effectiveFeatureSources",null),Nn=(0,r._)([(0,d.$)("esri.views.interactive.snapping.SnappingOptions")],Nn);const qn=Nn;function Xn(e){return"subtype-group"===e.layer.type}function Un(e){return"subtype-group"!==e.layer.type}function Bn(e){return"subtype-sublayer"===e.layer.type}var Wn=n(53494),$n=n(75543),Yn=n(34154),Qn=n(8203),Jn=n(46530),Kn=n(31933),ei=n(90992);let ti=class extends s.A{get layerView(){var e;return null===(e=this.view)||void 0===e||null===(e=e.allLayerViews)||void 0===e?void 0:e.find((e=>e.layer===this.layer))}get valid(){return this._valid}get subtypeFilter(){var e,t,n;const{layer:i,snappingSource:r}=this;if(!(0,Kn.F2)(i)||null===(e=i.subtypes)||void 0===e||!e.length)return{mode:"not-in-use",filter:null};const s=r.layerSource.sublayerSources.filter((e=>{var t;return e.enabled&&e.layer.visible&&(0,ei.JU)(null===(t=this.view)||void 0===t?void 0:t.scale,e.layer.effectiveScaleRange.minScale,e.layer.effectiveScaleRange.maxScale)})).map((e=>e.layer.subtypeCode));if(!s.length)return{mode:"none-visible",filter:null};if(s.length===i.subtypes.length)return{mode:"all-visible",filter:null};const o=null!==(t=null===(n=i.fieldsIndex.get(i.subtypeField))||void 0===n?void 0:n.name)&&void 0!==t?t:i.subtypeField;return 1===s.length?{mode:"in-use",filter:"".concat(o," = ").concat(s.getItemAt(0))}:{mode:"in-use",filter:"".concat(o," IN (").concat(s.join(", "),")")}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,Jn.E)({view:e,layer:t}):null}constructor(e){super(e),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:e,snappingSource:t}=this;if("refresh"in e){const n=e;this.addHandles(n.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,c.wB)((()=>t.updating),(e=>t.layerSource.updating=e),c.pc),(0,c.wB)((()=>t.availability),(e=>t.layerSource.availability=e),c.pc)])}getFetchCandidatesParameters(e,t,n){var i,r,s,o,a;if(!this.valid)return[];const{layer:l,layerView:c,floorFilter:u,rulesTable:d,subtypeFilter:h}=this,p={distance:n,mode:null!==(i=null===(r=this.view)||void 0===r?void 0:r.type)&&void 0!==i?i:"2d",point:e,coordinateHelper:t.coordinateHelper,...this._types,filter:c&&"filter"in c?c.filter:null};if(u&&(p.filter=ni(p.filter,u)),"not-in-use"!==h.mode&&"all-visible"!==h.mode){if("none-visible"===h.mode)return[];p.filter?p.filter.where=(0,Yn.m)(p.filter.where,h.mode):p.filter=new Qn.A({where:h.filter})}const f=t.feature,_="subtype-sublayer"===(null===f||void 0===f||null===(s=f.sourceLayer)||void 0===s?void 0:s.type)?f.sourceLayer.parent:null===f||void 0===f?void 0:f.sourceLayer;if(d&&f&&(0,cn.Tu)(null===(o=this.view)||void 0===o?void 0:o.map)&&((0,Kn.yZ)(l)||(0,Kn.F2)(l))&&l.layerId&&((0,Kn.yZ)(_)||(0,Kn.F2)(_))&&null!==(a=this.view.map.utilityNetworks)&&void 0!==a&&a.find((e=>e.isUtilityLayer(_)))){var m;if("loaded"!==d.loadStatus)return[];const e=[],t=l.layerId,n=null===(m=d.getFeatureSQL(_,f))||void 0===m?void 0:m[t];if(!n)return[];const i=n.anyVertex;let r=n.endVertex;return r&&i&&r===i&&(r=""),r&&e.push({...p,returnEdge:!1,vertexMode:"ends",filter:ni(p.filter,r)}),i&&e.push({...p,returnEdge:!1,vertexMode:"all",filter:ni(p.filter,i)}),e}return[p]}async loadRules(){const{layer:e,view:t}=this;if(e&&t&&(0,cn.Tu)(null===t||void 0===t?void 0:t.map)&&((0,Kn.yZ)(e)||(0,Kn.F2)(e))){var n;const s=null===(n=t.map.utilityNetworks)||void 0===n?void 0:n.find((t=>t.isUtilityLayer(e)));if(s)try{var i;this.rulesTable=await s.getRulesTable(),await(null===(i=this.rulesTable)||void 0===i?void 0:i.load())}catch(r){return void a.A.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}}this._valid=!0}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){var e;null===(e=this.snappingSource)||void 0===e||e.destroy()}};function ni(e,t){return null==e?new Qn.A({where:t}):e.where?new Qn.A({where:(0,Yn.m)(e.where,t)}):new Qn.A({where:t})}(0,r._)([(0,u.MZ)({constructOnly:!0})],ti.prototype,"layer",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],ti.prototype,"snappingSource",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],ti.prototype,"view",void 0),(0,r._)([(0,u.MZ)()],ti.prototype,"layerView",null),(0,r._)([(0,u.MZ)()],ti.prototype,"rulesTable",void 0),(0,r._)([(0,u.MZ)()],ti.prototype,"valid",null),(0,r._)([(0,u.MZ)()],ti.prototype,"subtypeFilter",null),(0,r._)([(0,u.MZ)()],ti.prototype,"floorFilter",null),(0,r._)([(0,u.MZ)()],ti.prototype,"_valid",void 0),ti=(0,r._)([(0,d.$)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],ti);var ii,ri=n(80794),si=n(9876),oi=n(61751),ai=n(30003);class li extends ai.C{constructor(e){let{targetPoint:t,constraint:n,previousVertex:i,otherVertex:r,otherVertexType:s,objectId:o,isDraped:a}=e;super(t,n,a,ln.n.SELF),this.previousVertex=i,this.otherVertex=r,this.otherVertexType=s,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===ii.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===ii.CENTER?this.targetPoint:this.otherVertex;return[new hn.c(cn.H3.TARGET,t,n,this.isDraped,this.domain),new hn.c(cn.H3.REFERENCE,e,t,this.isDraped,this.domain),new _n(this.previousVertex,t,n,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(ii||(ii={}));let ci=class extends s.A{get updating(){return this._snappingSources.some((e=>null==e||e.valid&&e.snappingSource.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=ln.n.FEATURE,this._updatingHandles=new wt.U,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,c.lZ)((()=>{var e;return null===(e=this.options)||void 0===e?void 0:e._effectiveFeatureSources}),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles((0,o.DQ)(e))}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,n,i){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const r=[],s=this._computeScreenSizeDistanceParameters(e,n);for(const l of this._snappingSources){var o;if(null==l||!l.valid||!l.snappingSource.layerSource.enabled||null!==(o=l.layerView)&&void 0!==o&&o.suspended)continue;const t=l.getFetchCandidatesParameters(e,n,s);for(const e of t)r.push(l.snappingSource.fetchCandidates(e,i).then((e=>e.filter((e=>!this._candidateIsExcluded(l.snappingSource,e,n.excludeFeature))))))}const a=(await(0,St.nA)(r)).flat();return this._addRightAngleCandidates(a,e,s,n),(0,St.Te)(i),(0,cn.xX)(e,a),a}_addRightAngleCandidates(e,t,n,i){var r,s,o,a;const l=null!=i.vertexHandle?null===(r=i.vertexHandle.rightEdge)||void 0===r||null===(r=r.rightVertex)||void 0===r?void 0:r.pos:null!=i.editGeometryOperations&&"polygon"===i.editGeometryOperations.data.type?null===(s=i.editGeometryOperations.data.components[0])||void 0===s||null===(s=s.getFirstVertex())||void 0===s?void 0:s.pos:null,c=null!=i.vertexHandle?null===(o=i.vertexHandle.leftEdge)||void 0===o||null===(o=o.leftVertex)||void 0===o?void 0:o.pos:null!=i.editGeometryOperations?null===(a=i.editGeometryOperations.data.components[0])||void 0===a||null===(a=a.getLastVertex())||void 0===a?void 0:a.pos:null,{view:u}=this,d=(0,nn.Lp)(l,u,i),h=(0,nn.Lp)(c,u,i),p=e.length;for(let f=0;f<p;f++)this._addRightAngleCandidate(e[f],h,t,n,e),this._addRightAngleCandidate(e[f],d,t,n,e)}_addRightAngleCandidate(e,t,n,i,r){if(null==t||!function(e){return(e instanceof si.z||e instanceof ri.X)&&!function(e){let{constraint:{start:t,end:n}}=e;const i=(0,S.a)(t,n),r=(0,Nt.hG)((0,nn.Xz)(t),(0,nn.Xz)(n));return i<(0,Wn.FD)()||r/i<pi}(e)}(e))return;const s=e.constraint.closestTo(t),o=(s[0]-n[0])/i.x,a=(s[1]-n[1])/i.y,{start:l,end:c}=e.constraint;if(o*o+a*a<=1){const n=new li({targetPoint:s,otherVertex:t,otherVertexType:ii.NEXT,previousVertex:(0,Nt.hG)((0,nn.Xz)(s),(0,nn.Xz)(l))>(0,Nt.hG)((0,nn.Xz)(s),(0,nn.Xz)(c))?l:c,constraint:new $n.FX(t,s),objectId:e.objectId,isDraped:e.isDraped});r.push(n)}}_computeScreenSizeDistanceParameters(e,t){let n=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:n,y:n,z:n,distance:n}:"2d"===this.view.type?(n*=this.view.resolution,{x:n,y:n,z:n,distance:n}):this._computeScreenSizeDistanceParameters3D(e,n,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,n,i){const{spatialReference:r}=i;n.renderCoordsHelper.toRenderCoords(e,r,di);const s=n.state.camera.computeScreenPixelSizeAt(di),o=s*n.renderCoordsHelper.unitInMeters,a=o/(0,f.GA)(r),l=o/(0,f.G9)(r),c=t*a,u=t*l,d=(0,vn.jq)(e,r,Pt.qt,n),h=d?ui(d,e,a,0,0,n,i):0,p=d?ui(d,e,0,a,0,n,i):0,_=d?ui(d,e,0,0,l,n,i):0;return{x:0===h?0:c/h,y:0===p?0:c/p,z:0===_?0:u/_,distance:s*t}}_candidateIsExcluded(e,t,n){if(null==n)return!1;const i=this._getCandidateObjectId(t);if(null==i)return!1;const r=e.layerSource.layer;return"graphics"===r.type?n.uid===i:n.sourceLayer===r&&!(!n.attributes||!("objectIdField"in r))&&n.attributes[r.objectIdField]===i}_getCandidateObjectId(e){return e instanceof oi.w?e.objectId:null}async _createSourceInfo(e,t){const n=e.layer;n.loaded||(await n.load(),(0,St.Te)(t));const{view:i}=this,r=await this._createFeatureSnappingSourceType(e);return(0,St.Te)(t),new ti(null==r?{}:{snappingSource:r,view:i,layer:n})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch(null===(t=e.layer.source)||void 0===t?void 0:t.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>{var t,n;return null!==(t=null===(n=e.layer.sublayers)||void 0===n?void 0:n.toArray())&&void 0!==t?t:[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),n={module:null,loader:t};this._sourceModules[e]=n;const i=await t,r={module:i,loader:t};return this._sourceModules[e]=r,i}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(n.e(5376).then(n.bind(n,85376)));case"featureCollection":return t.addPromise(n.e(7567).then(n.bind(n,77567)));case"graphics":case"notes":return t.addPromise(Promise.all([n.e(7216),n.e(3620),n.e(2003),n.e(1047),n.e(9546)]).then(n.bind(n,99546)));case"scene":return t.addPromise(n.e(3537).then(n.bind(n,13537)))}}get test(){return{snappingSources:this._snappingSources}}};function ui(e,t,n,i,r,s,o){let{spatialReference:a}=o;const l=(0,S.c)(hi,t);l[0]+=n,l[1]+=i,l[2]+=r;const c=(0,vn.jq)(l,a,Pt.qt,s);return c?(0,cn.Mo)(c,e):1/0}(0,r._)([(0,u.MZ)({constructOnly:!0})],ci.prototype,"spatialReference",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],ci.prototype,"view",void 0),(0,r._)([(0,u.MZ)()],ci.prototype,"options",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],ci.prototype,"updating",null),(0,r._)([(0,u.MZ)()],ci.prototype,"_snappingSources",void 0),ci=(0,r._)([(0,d.$)("esri.views.interactive.snapping.FeatureSnappingEngine")],ci);const di=(0,w.vt)(),hi=(0,w.vt)(),pi=1e-4;var fi,_i=n(54099),mi=n(9624);class vi{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=an.shortLineThreshold*an.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,nn.Lp)(e.leftVertex.pos,this.view,t),(0,nn.Lp)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,n){let{spatialReference:i}=n;return 0===this.squaredShortLineThreshold||(0,cn.pM)((0,vn.jq)(t,i,Pt.qt,this.view),(0,vn.jq)(e,i,Pt.qt,this.view))>this.squaredShortLineThreshold}isVertical(e,t,n){let{spatialReference:i}=n;const r=(0,f.GA)(i);return(0,Nt.Io)((0,nn.Xz)(e),(0,nn.Xz)(t))*r<an.verticalLineThresholdMeters}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}}class gi extends ai.C{constructor(e){let{lineStart:t,lineEnd:n,targetPoint:i,isDraped:r}=e;super(i,new $n.WG(t,n),r,ln.n.SELF),this._referenceLineHint=new hn.c(cn.H3.REFERENCE_EXTENSION,t,n,r,this.domain)}get hints(){return[this._referenceLineHint,new hn.c(cn.H3.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}!function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"}(fi||(fi={}));(()=>{const e=(0,w.vt)(),t=(0,w.vt)()})();const yi=(()=>{const e=(0,qt.vt)(),t=(0,w.vt)(),n=(0,w.vt)();return(i,r,s,o)=>{if((0,S.j)(i,r))return;const a=(0,F.Xn)(s),l=(0,F.Xn)(o);if(a&&l&&(0,C.aI)(a,l)&&(0,R.F)(i,s,t,a)&&(0,R.F)(r,o,n,l)){const{azimuth:e}=(0,F._3)(Mi,t,n,a);return null!=e?(0,f.oU)(e,"degrees","radians"):void 0}e[0]=r[0]-i[0],e[1]=r[1]-i[1];let c=(0,Nt.g7)(qt.JP,e);return e[0]<0&&(c=bi-c),c}})();const Si=(()=>{const e=(0,w.vt)();return function(t,n,i,r,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"geodesic";(0,S.c)(e,n);const a=wi(s);if("geodesic"===o){const s=(0,F.Xn)(i);if(s&&(0,R.F)(e,i,e,s))return(0,F.vN)(t,e,a,r,s),t[2]=n[2],!!(0,R.F)(t,s,t,i)}const l=(0,v.g2)(a,"geographic","arithmetic"),c=(0,f.oU)(l,"degrees","radians"),u=n[0]+r*Math.cos(c),d=n[1]+r*Math.sin(c),h=n[2];return(0,S.s)(t,u,d,h),!0}})();function wi(e){return null!=e?(0,v.g2)((0,f.oU)(e.value,e.unit,"degrees"),e.rotationType,"geographic"):void 0}const Mi=new F.Zj,bi=2*Math.PI;new we.hr(-180,180);var Pi=n(79337),xi=n(74050);class Oi extends vi{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=[];if(i<1)return r;const{spatialReference:s}=t,o=(0,vn.jq)(e,s,Pt.qt,this.view),{view:a}=this,l=n.edges[i-1];let c=l;do{if(this.edgeExceedsShortLineThreshold(c,t)){const n=(0,cn.is)(c,a,t);this._processCandidateProposal(n.left,n.right,e,o,t,r)}c=c.leftVertex.leftEdge}while(c&&c!==l);return r}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<2)return n;const{view:s}=this,{spatialReference:o}=t,a=(0,vn.jq)(e,o,Pt.qt,s),l=i.leftEdge,c=i.rightEdge;l&&c&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal((0,nn.Lp)(l.leftVertex.pos,s,t),(0,nn.Lp)(c.rightVertex.pos,s,t),e,a,t,n);const u=r.edges[0];let d=u;do{if(d!==i.leftEdge&&d!==i.rightEdge&&this.edgeExceedsShortLineThreshold(d,t)){const i=(0,cn.is)(d,s,t);this._processCandidateProposal(i.left,i.right,e,a,t,n)}d=d.rightVertex.rightEdge}while(d&&d!==u);return n}_processCandidateProposal(e,t,n,i,r,s){var o;const{spatialReference:a,pointer:l}=r,c=(0,w.vt)();this._projectedLine(c,e,t,n,r);const u=(0,nn._7)(c);(0,cn.pM)(i,(0,vn.jq)(u,a,Pt.qt,this.view))<this.squaredProximityThreshold(l)&&s.push(new gi({lineStart:e,lineEnd:t,targetPoint:u,isDraped:"on-the-ground"===(null===(o=r.elevationInfo)||void 0===o?void 0:o.mode)}))}_projectedLine(e,t,n,i,r){this._projectToLineGeodesic(e,t,n,i,r)||this._projectToLinePlanar(e,i,t,n)}_projectToLineGeodesic(e,t,n,i,r){let{spatialReference:s}=r;const o=yi(t,n,s,s);if(null==o)return!1;const a=yi(n,i,s,s);if(null==a)return!1;const l=N(n,i,s);if(null==l)return!1;const c=Math.abs(we.wf.shortestSignedDiff(o,a))>Math.PI/2?we.uC.normalize(o+Math.PI):o;return Si(e,n,s,(0,v.l3)(l,"meters"),(0,v.Wq)(c,"radians","geographic"),"geodesic"),e[2]=i[2],!0}_projectToLinePlanar(e,t,n,i){(0,Pi.Yv)(t,{start:n,end:i,type:xi.Vv.LINE},e),e[2]=t[2]}}class Ri extends ai.C{constructor(e){let{referenceLine:t,lineStart:n,targetPoint:i,isDraped:r}=e;const s=(0,w.o8)(n),{left:o,right:a}=t;(0,S.f)(s,(0,S.g)(s,s,a),o),super(i,new $n.WG(n,(0,nn._7)(s)),r,ln.n.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new hn.c(cn.H3.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new pn(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new hn.c(cn.H3.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((n=>{(0,S.j)(e.right,n.edge.left)&&(n.fadeLeft=!1,t.fadeRight=!1),(0,S.j)(e.right,n.edge.right)&&(n.fadeRight=!1,t.fadeRight=!1),(0,S.j)(e.left,n.edge.right)&&(n.fadeRight=!1,t.fadeLeft=!1),(0,S.j)(e.left,n.edge.left)&&(n.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class Ci extends vi{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=n.vertices.length,s=[];if(i<2)return s;const{view:o}=this,a=(0,vn.jq)(e,t.spatialReference,Pt.qt,o),l=(0,nn.Lp)(n.vertices[r-1].pos,o,t),c=(0,nn.Lp)(n.vertices[0].pos,o,t),u=n.edges[i-1];let d=u;do{if(this.edgeExceedsShortLineThreshold(d,t)){const n=(0,cn.is)(d,o,t);this._checkEdgeForParallelLines(n,l,e,a,t,s),this._checkEdgeForParallelLines(n,c,e,a,t,s)}d=d.leftVertex.leftEdge}while(d&&d!==u);return s}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<3)return n;const{view:s}=this,o=(0,vn.jq)(e,t.spatialReference,Pt.qt,s),a=i.leftEdge,l=i.rightEdge,c=r.vertices[0],u=(0,nn.Lp)(c.pos,s,t),d=r.vertices.length,h=r.vertices[d-1],p=(0,nn.Lp)(h.pos,s,t),f=r.edges[0];let _=f;do{if(_!==a&&_!==l&&this.edgeExceedsShortLineThreshold(_,t)){const r=(0,cn.is)(_,s,t);a&&this._checkEdgeForParallelLines(r,(0,nn.Lp)(a.leftVertex.pos,s,t),e,o,t,n),l&&this._checkEdgeForParallelLines(r,(0,nn.Lp)(l.rightVertex.pos,s,t),e,o,t,n),i===c?this._checkEdgeForParallelLines(r,p,e,o,t,n):i===h&&this._checkEdgeForParallelLines(r,u,e,o,t,n)}_=_.rightVertex.rightEdge}while(_&&_!==f);return n}_checkEdgeForParallelLines(e,t,n,i,r,s){const o=e.left,a=e.right;if((0,xi.fg)(Ti,(0,nn.Xz)(t),(0,nn.Xz)(o),(0,nn.Xz)(a)),(0,Nt.hG)(Ti,(0,nn.Xz)(t))<an.parallelLineThreshold)return;(0,xi.fg)(Ti,(0,nn.Xz)(n),(0,nn.Xz)(o),(0,nn.Xz)(a),(0,nn.Xz)(t));const{spatialReference:l,pointer:c}=r,u=(0,nn.fA)(Ti[0],Ti[1],n[2]);if((0,cn.pM)(i,(0,vn.jq)(u,l,Pt.qt,this.view))<this.squaredProximityThreshold(c)){var d;if(this.isVertical(u,t,r)||this.isVertical(o,a,r))return;if(this._parallelToPreviousCandidate(e,s))return;s.push(new Ri({referenceLine:e,lineStart:t,targetPoint:u,isDraped:"on-the-ground"===(null===(d=r.elevationInfo)||void 0===d?void 0:d.mode)}))}}_parallelToPreviousCandidate(e,t){const n=e.left,i=e.right;for(const r of t)if((0,xi.fg)(Ti,(0,nn.Xz)(i),(0,nn.Xz)(r.constraint.start),(0,nn.Xz)(r.constraint.end),(0,nn.Xz)(n)),(0,Nt.hG)(Ti,(0,nn.Xz)(i))<an.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}}const Ti=(0,qt.vt)();class Ei extends vi{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=[];if(n.vertices.length<2)return i;const{view:r}=this,s=(0,vn.jq)(e,t.spatialReference,Pt.qt,r),o=n.vertices.at(-1);this._checkForSnappingCandidate(i,o.leftEdge,o,o.leftEdge.leftVertex,e,s,t);const a=n.vertices[0];return this._checkForSnappingCandidate(i,a.rightEdge,a,a.rightEdge.rightVertex,e,s,t),i}snapExistingVertex(e,t){const n=[],i=t.vertexHandle;if(i.component.vertices.length<3)return n;const{view:r}=this,s=(0,vn.jq)(e,t.spatialReference,Pt.qt,r),o=i.leftEdge,a=i.rightEdge;if(null!==o&&void 0!==o&&o.leftVertex.leftEdge){const i=o.leftVertex.leftEdge;this._checkForSnappingCandidate(n,i,i.rightVertex,i.leftVertex,e,s,t)}if(null!==a&&void 0!==a&&a.rightVertex.rightEdge){const i=a.rightVertex.rightEdge;this._checkForSnappingCandidate(n,i,i.leftVertex,i.rightVertex,e,s,t)}return n}_checkForSnappingCandidate(e,t,n,i,r,s,o){if(!this.edgeExceedsShortLineThreshold(t,o))return;const a=this.view,l=(0,nn.Lp)(n.pos,a,o),c=(0,nn.Lp)(i.pos,a,o);this._checkForSnappingCandidateNormalized(e,c,l,r,s,o)}_checkForSnappingCandidateNormalized(e,t,n,i,r,s){this._projectionRay(Di,t,n,i,s),this._checkForSnappingCandidateAlongProjectedRay(e,t,n,Di,i,r,s)}_projectionRay(e,t,n,i,r){this._projectionRayGeodesic(e,t,n,i,r)||this._projectionRayPlanar(e,t,n)}_projectionRayGeodesic(e,t,n,i,r){let{spatialReference:s}=r;const o=yi(t,n,s,s);if(null==o)return!1;const a=yi(n,i,s,s);if(null==a)return!1;const l=Math.sign(we.uC.shortestSignedDiff(o,a))*Math.PI*.5,c=(0,v.Wq)(o+l,"radians","geographic"),u=(0,w.vt)(),d=N(n,i,s);return null!=d&&(Si(u,n,s,(0,v.l3)(d,"meters"),c,"geodesic"),(0,S.f)(e,u,n),!0)}_projectionRayPlanar(e,t,n){const i=(0,Nt.Re)(Ai,(0,nn.Xz)(n),(0,nn.Xz)(t));(0,S.s)(e,i[1],-i[0],0)}_checkForSnappingCandidateAlongProjectedRay(e,t,n,i,r,s,o){var a;const{spatialReference:l,pointer:c}=o,u=(0,Nt.Re)(Ai,(0,nn.Xz)(r),(0,nn.Xz)(n)),d=(0,Nt.Om)(i,u)/(0,Nt.m3)(i),h=(0,Nt.Ln)(Ai,(0,nn.Xz)(n),i,d),p=(0,nn.fA)(h[0],h[1],r[2]);if((0,cn.pM)(s,(0,vn.jq)(p,l,Pt.qt,this.view))>this.squaredProximityThreshold(c)||this.isVertical(p,n,o)||this.isVertical(n,t,o))return;const f=(0,S.r)((0,w.vt)(),n,i,Math.sign(d));e.push(new li({targetPoint:p,constraint:new $n.FX(n,(0,nn._7)(f)),previousVertex:t,otherVertex:n,otherVertexType:ii.CENTER,isDraped:"on-the-ground"===(null===(a=o.elevationInfo)||void 0===a?void 0:a.mode)}))}}const Ai=(0,qt.vt)(),Di=(0,w.vt)();class Li extends ai.C{constructor(e){let{targetPoint:t,point1:n,point2:i,isDraped:r}=e;super(t,new $n.ej((0,nn._7)((0,S.m)((0,w.vt)(),n,i,.5)),.5*(0,Nt.Io)((0,nn.Xz)(n),(0,nn.Xz)(i))),r,ln.n.SELF),this._p1=n,this._p2=i}get hints(){return[new hn.c(cn.H3.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new hn.c(cn.H3.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new _n(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class zi extends vi{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=[],r=n.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return i;const{view:s}=this,o=n.vertices[0],a=n.vertices[r-1],l=(0,nn.Lp)(o.pos,s,t),c=(0,nn.Lp)(a.pos,s,t);return this._processCandidateProposal(l,c,e,t,i),i}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<2)return n;if("polyline"===t.editGeometryOperations.data.type&&(0===i.index||i.index===r.vertices.length-1))return n;const{view:s}=this,o=(0,nn.Lp)(i.leftEdge.leftVertex.pos,s,t),a=(0,nn.Lp)(i.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(o,a,e,t,n),n}_processCandidateProposal(e,t,n,i,r){if(!this.exceedsShortLineThreshold(e,t,i))return;const s=(0,Nt.Cc)(Hi,(0,nn.Xz)(e),(0,nn.Xz)(t),.5),o=.5*(0,Nt.Io)((0,nn.Xz)(e),(0,nn.Xz)(t)),a=(0,xi.Dh)(Hi,(0,nn.Xz)(n),s,o),l=(0,nn.fA)(a[0],a[1],n[2]),{spatialReference:c,pointer:u}=i,d=(0,vn.jq)(n,c,Pt.qt,this.view);if((0,cn.pM)(d,(0,vn.jq)(l,c,Pt.qt,this.view))<this.squaredProximityThreshold(u)){var h;if(this.isVertical(e,l,i)||this.isVertical(l,t,i))return;r.push(new Li({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===(null===(h=i.elevationInfo)||void 0===h?void 0:h.mode)}))}}}const Hi=(0,qt.vt)();let ji=class extends s.A{constructor(e){super(e),this.updating=!1,this._snappers=new Zn.A,this._domain=ln.n.SELF}initialize(){this._snappers.push(new Ci(this.view,this.options),new Oi(this.view,this.options),new Ei(this.view,this.options),new zi(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,n){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const i=[];for(const r of this._snappers.items)for(const t of r.snap(e,n))i.push(t);return(0,cn.xX)(e,i),i}};function Gi(e,t){return[new ji({view:e,options:t}),new ci({view:e,options:t,spatialReference:e.spatialReference})]}(0,r._)([(0,u.MZ)({readOnly:!0})],ji.prototype,"updating",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],ji.prototype,"view",void 0),(0,r._)([(0,u.MZ)()],ji.prototype,"options",null),ji=(0,r._)([(0,d.$)("esri.views.interactive.snapping.SelfSnappingEngine")],ji);class Vi extends ai.C{constructor(e,t,n,i){super(e,new $n.i7(e),i,ln.n.ALL),this.first=t,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new dn(this.targetPoint,this.isDraped,this.domain)]}}let Zi=class extends(_i.A.EventedMixin(s.A)){constructor(e){super(e),this.options=new qn,this.snappingEnginesFactory=Gi,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Fi.MAIN}initialize(){this.addHandles([(0,c.wB)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:i,constraintsActive:r}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:i,constraintsActive:r}}),(()=>{this.doneSnapping(),this.emit("changed")}),c.OH),(0,c.wB)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),c.OH),(0,c.wB)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:n}=e;return this._recreateEngines(t,n)}),c.pc)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:n,options:i}=this;this._engines=t(n,i)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}get _squaredSatisfiesConstraintThreshold(){return an.satisfiesConstraintScreenThreshold*an.satisfiesConstraintScreenThreshold}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const i=this._currentMainCandidate;if(null==i)return t;const r=this._selectUpdateInput(e);if(null==r)return t;const{spatialReference:s}=n,o=(0,mi.project)(r,s);if(null==o)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=n,u=[],d=(0,nn.vf)(o,a,l),h=i.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,h,n))return this._resetSnappingState(),t;i.targetPoint=h,u.push(...i.hints);for(const p of this._currentOtherActiveCandidates)p.targetPoint=h,u.push(...p.hints);return null!=c&&this.addHandles(c.draw(u,{spatialReference:s,elevationInfo:Ii(n),view:a,selfSnappingZ:n.selfSnappingZ}),ki),(0,nn.xF)(h,a,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:n}=e;switch(this._currentSnappedType){case Fi.MAIN:return t;case Fi.SCENE:return n}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Fi.MAIN}_removeVisualization(){this.removeHandles(ki)}async _snapSinglePoint(e){let{point:t,context:n,signal:i}=e;const{view:r}=this,{elevationInfo:s}=n,o=(0,nn.vf)(t,r,s),a=await this._fetchCandidates(o,ln.n.ALL,n,i);return this._createSnapResult(o,Fi.MAIN,a,r,t,n,i)}async _snapMultiPoint(e){var t,n;let{point:i,scenePoint:r,context:s,signal:o}=e;const{view:a}=this,{coordinateHelper:l,elevationInfo:c,spatialReference:u}=s;await(0,mi.initializeProjection)(r.spatialReference,u);const d=(0,mi.project)(r,u),h=(0,nn.vf)(d,a,c),p=await this._fetchCandidates(h,ln.n.FEATURE,s,o);if(p.length>0){const e=await this._fetchCandidates(h,ln.n.SELF,s,o);return this._createSnapResult(h,Fi.SCENE,[...p,...e],a,d,s,o)}const f=(0,nn.vf)(i,a,c),_=await this._fetchCandidates(f,ln.n.SELF,s,o);return this._createSnapResult(f,Fi.MAIN,_,a,{z:l.hasZ()&&i.hasZ?null!==(t=i.z)&&void 0!==t?t:0:void 0,m:l.hasM()&&i.hasM?null!==(n=i.m)&&void 0!==n?n:0:void 0},s,o)}async _fetchCandidates(e,t,n,i){return(await Promise.all(this._engines.map((r=>r.fetchCandidates(e,t,n,i))))).flat()}_createSnapResult(e,t,n,i,r,s,o){return{get valid(){return!(0,St.G4)(o)},apply:()=>{const{spatialReference:o}=s,{snappedPoint:a,hints:l}=this._processCandidates(e,t,n,s);return this._removeVisualization(),null!=s.visualizer&&this.addHandles(s.visualizer.draw(l,{spatialReference:o,elevationInfo:Pt.qt,view:i,selfSnappingZ:s.selfSnappingZ}),ki),(0,nn.xF)(a,i,r,s)}}}_processCandidates(e,t,n,i){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,cn.xX)(e,n);const r=this._currentMainCandidate;if(null!=r){const s=this._findOldConstraintInNewCandidates(r,n);if(s>=0){if(!(n[s]instanceof Vi))return this._intersectWithOtherCandidates(s,n,e,t,i);if(this._arePointsWithinScreenThreshold(e,r.targetPoint,i))return this._updateSnappingCandidate(r,t,n,i)}}return this._intersectWithOtherCandidates(0,n,e,t,i)}_findOldConstraintInNewCandidates(e,t){return e instanceof Vi?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,n,i,r){const{coordinateHelper:s}=r,o=t[e],a=[];for(let l=0;l<t.length;++l){if(l===e)continue;const i=t[l],r=o.constraint.intersect(i.constraint);if(r)for(const e of r.closestPoints(o.targetPoint))a.push([new Vi(e,o,i,i.isDraped),this._squaredScreenDistance(n,e,s)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(a[0][0],i,t,r):this.options.constraintsActive&&(o instanceof gi||o instanceof si.z||o instanceof li||o instanceof Ri)?{snappedPoint:n,hints:[]}:this._updateSnappingCandidate(o,i,t,r)}_updateSnappingCandidate(e,t,n,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const o of n){if(e instanceof Vi){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const t=o.constraint.closestTo(r);this._squaredScreenDistance(t,r,i.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=r,this._currentOtherActiveCandidates.push(o),s.push(...o.hints))}return{snappedPoint:r,hints:s}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return(0,cn.pM)(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return(0,vn.jq)(e,t.spatialReference,Pt.qt,this.view)}_findOldCandidateIndex(e,t){let n=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){n=i;break}return n}get test(){return{visualizationsActive:this.hasHandles(ki),engines:this._engines}}};var Fi;(0,r._)([(0,u.MZ)({constructOnly:!0})],Zi.prototype,"view",void 0),(0,r._)([(0,u.MZ)()],Zi.prototype,"options",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],Zi.prototype,"updating",null),(0,r._)([(0,u.MZ)()],Zi.prototype,"snappingEnginesFactory",void 0),(0,r._)([(0,u.MZ)()],Zi.prototype,"_engines",void 0),(0,r._)([(0,u.MZ)()],Zi.prototype,"_squaredMouseProximityThreshold",null),(0,r._)([(0,u.MZ)()],Zi.prototype,"_squaredTouchProximityThreshold",null),(0,r._)([(0,u.MZ)()],Zi.prototype,"_squaredSatisfiesConstraintThreshold",null),Zi=(0,r._)([(0,d.$)("esri.views.interactive.snapping.SnappingManager")],Zi),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(Fi||(Fi={}));const ki="visualization-handle";function Ii(e){let{coordinateHelper:t,elevationInfo:n}=e;return t.hasZ()?Pt.qt:n}const Ni=new Map;function qi(e){if(!Ni.has(e)){const t=function(e,t){var n,i;const r=new qn({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(n=null===t||void 0===t?void 0:t.distance)&&void 0!==n?n:an.distance,touchSensitivityMultiplier:null!==(i=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==i?i:an.touchSensitivityMultiplier});return{...(0,c.wB)((()=>{var t,n;return null!==(t=null===(n=e.map)||void 0===n||null===(n=n.allLayers)||void 0===n?void 0:n.toArray())&&void 0!==t?t:[]}),(e=>{r.featureSources=new Zn.A(e.map((e=>new kn({layer:e,enabled:!0}))))}),c.Vh),options:r}}(e,{distance:10}),n=function(e,t){return new Zi({view:e,options:t,snappingEnginesFactory:(t,n)=>[new ci({view:e,spatialReference:e.spatialReference,options:n})]})}(e,t.options);Ni.set(e,{referenceCount:0,snappingManager:n,remove:()=>{t.remove(),n.destroy()}})}const t=Ni.get(e);t.referenceCount++;const n=(0,o.hA)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,Vn.d)((()=>{0===t.referenceCount&&(t.remove(),Ni.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...n}}class Xi{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}var Ui=n(74e3),Bi=n(59752);function Wi(e){let{predicate:t=(()=>!0),snappingManager:n,snappingContext:i,updatingHandles:r,useZ:s=!0}=e;const o=new Ne.rh;if(null==n)return{snappingStep:[Ji,o],cancelSnapping:Ji};let a,u=null,d=null,h=null;const p=()=>{var e;u=(0,l.DC)(u),n.doneSnapping(),null!==(e=d)&&void 0!==e&&e.frameTask.remove(),d=null,a=(0,l.xt)(a),h=null},f=function(e,t,n){return(0,St.sg)((async(i,r)=>{let{frameTask:s,point:o,scenePoint:a,context:l,event:c,delta:u,getLastState:d}=i;const h=await s.schedule((()=>e.snap({point:o,scenePoint:a,context:l,signal:r})),r);if(h.valid){let i=await s.schedule((()=>h.apply()),r);const a=d();null!=a.point&&o!==a.point&&(i=e.update({point:a.point,scenePoint:a.scenePoint,context:l})),null!=a.updatePoint&&(0,Ui.CI)(i,a.updatePoint)||(Qi(c.mapEnd,i,u,t),n.execute(c))}}))}(n,s,o);let _=null,m=null,v=null;return{snappingStep:[e=>{if(!t(e))return e;const{action:o}=e;if("start"===o){const{info:t}=e,r=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(Bi.W6.SNAPPING):Bi.nu}(n.view);if(d=function(e,t,n){return{context:new Xi({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:n}}(i,e,r),d.context.selfSnappingZ=null,!s&&null!=t){var l;const e=function(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const r of n){const t=e.getZ(r.pos);if(null!=i&&null!=t&&Math.abs(t-i)>1e-6)return null;null==i&&(i=t)}return i}(i.coordinateHelper,t.handle.component);null!=e&&(d.context.selfSnappingZ={value:e,elevationInfo:null!==(l=i.elevationInfo)&&void 0!==l?l:Pt.qt})}}if(null!=d){const{context:t,originalScenePos:i,originalPos:l}=d,{mapEnd:p,mapStart:g,scenePoints:y}=e,S=$i(l,Yi(p,g)),w=Yi(g,l),M={...e,action:"update"},b=d.context,P=function(e,t){return null==e||null==t?null:$i(e,Yi(t.sceneEnd,t.sceneStart))}(i,y),x=n.update({point:S,scenePoint:P,context:t});if(v=x,Qi(p,x,w,s),_=S,m=P,"end"!==o){const{frameTask:e}=d;null==u&&(u=new AbortController),h=t=>{r.addPromise((0,St.QZ)(f({frameTask:e,event:M,context:b,point:S,scenePoint:P,delta:w,getLastState:()=>({point:_,scenePoint:m,updatePoint:t.forceUpdate?null:v})},u.signal)))},h({forceUpdate:!1}),null==a&&(a=(0,c.wB)((()=>n.options.effectiveEnabled),(()=>{var e;return null===(e=h)||void 0===e?void 0:e({forceUpdate:!0})})))}}return"end"===o&&p(),e},o],cancelSnapping:e=>(p(),e)}}function $i(e,t){let[n,i,r]=t;const s=(0,x.EL)(e);return s.x+=n,s.y+=i,s.hasZ&&(s.z+=r),s}function Yi(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function Qi(e,t,n,i){let[r,s,o]=n;e.x=t.x+r,e.y=t.y+s,i&&e.hasZ&&t.hasZ&&(e.z=t.z+o)}function Ji(e){return e}let Ki=class extends s.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,St.sg)((async(e,t,n,i)=>{const r=this._frameTask;if(null==r)return;const s=await r.schedule((()=>t.snap({...e,context:n,signal:i})),i);s.valid&&await r.schedule((()=>{this.stagedPoint=s.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))}),i)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var e;const t="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(e=e.resourceController)||void 0===e?void 0:e.scheduler:null;this._frameTask=null!=t?t.registerTask(Bi.W6.SNAPPING):Bi.nu}destroy(){this._abortController=(0,l.DC)(this._abortController),this._frameTask=(0,l.xt)(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:r}=e,s=t.update({point:i,scenePoint:r,context:n});return this.stagedPoint=s,s}async snap(e,t,n){const{point:i,scenePoint:r}=e;return this.stagedPoint=t.update({point:i,scenePoint:r,context:n}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,l.DC)(this._abortController),this._snapPoints=null}};(0,r._)([(0,u.MZ)({constructOnly:!0})],Ki.prototype,"view",void 0),(0,r._)([(0,u.MZ)()],Ki.prototype,"stagedPoint",null),(0,r._)([(0,u.MZ)()],Ki.prototype,"constrainResult",void 0),(0,r._)([(0,u.MZ)()],Ki.prototype,"_stagedPoint",void 0),Ki=(0,r._)([(0,d.$)("esri.views.interactive.snapping.SnappingOperation")],Ki);let er=class extends s.A{constructor(e){super(e),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new vt.A,this._orientationManipulatorTexture=null,this._updatingHandles=new wt.U,this._getSnappingContext=(0,yt.B)((e=>new Xi({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new Gn.p(new jn.ZE("point",(0,Hn.BV)(!0,!1,this.view.spatialReference))),visualizer:new gn})));const{view:t}=e;this._snappingManagerResult=qi(t),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,zn.wk)(2)}),this._constraintSnappingIndicator=new Pn.t({view:t,attached:!0,width:1,renderOccluded:Ze.m$.OccludeAndTransparent,stipplePattern:(0,zn.wk)(5),isDecoration:!0});const n=Se.A.toUnitRGBA(Ce);this._stagedStartIndicator=new An({view:t,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,color:n,size:10,outlineSize:0,renderOccluded:Ze.m$.OccludeAndTransparent,isDecoration:!0})}initialize(){var e;const{view:t}=this;this._snappingOperation=new Ki({view:t});const n=!(null!==(e=t._stage)&&void 0!==e&&e.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this._orientationManipulatorMaterial=new ke.r({transparent:!0,writeDepth:!1,renderOccluded:Ze.m$.Opaque,isDecoration:!0}),this.addHandles((0,c.wB)((()=>({accentColor:Oe(t.effectiveTheme),contrastColor:Re(t.effectiveTheme)})),(e=>{let{accentColor:i,contrastColor:r}=e;const s=this._orientationManipulatorTexture,o=(0,bt.t)(t.textures,{accentColor:i,contrastColor:r,preMultiplyAlpha:n});this._orientationManipulatorMaterial.setParameters({textureId:o.texture.id}),this._orientationManipulatorTexture=o,null===s||void 0===s||s.release();const a=Se.A.toUnitRGBA(i);this._unfocusedOffsetManipulatorMaterial.setParameters({color:a}),this._focusedOffsetManipulatorMaterial.setParameters({color:a}),this._thinOffsetManipulatorMaterial.setParameters({color:a}),this._constraintSnappingIndicator.color=a}),c.Vh));const i=(0,c.LF)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createManipulators(t)}));this.addHandles((0,o.DQ)(i)),this.addHandles([(0,c.wB)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(e=>{let{stagedPoint:t,stagedComputation:n}=e;if(null==n||null==t)return;const i=(0,x.EL)(t,new Xe.A);this._applyPointUpdate(n,{endPoint:i})}),c.OH),(0,c.wB)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((e,t)=>{const{stagedDimension:n,selectedComputation:i,firstGrabbedManipulator:r}=e;if(n===(null===t||void 0===t?void 0:t.stagedDimension)&&r===(null===t||void 0===t?void 0:t.firstGrabbedManipulator)){for(const s of[i,null===t||void 0===t?void 0:t.selectedComputation])if(null!=s){const t=this._computationManipulators.get(s);null!=t&&this._updateManipulators(s,t,e)}}else for(const[s,o]of this._computationManipulators)this._updateManipulators(s,o,e)}),c.pc),(0,c.wB)((()=>this.analysis.style.lineSize),(e=>{this._updateManipulatorStyle(e)}),c.Vh),(0,c.wB)((()=>this.view.state.camera),(()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,c.wB)((()=>{const e=this._stagedComputation;if(!e)return null;const t=e.elevationAlignedStartPoint,n=(0,w.vt)();return null!=t&&this.view.renderCoordsHelper.toRenderCoords(t,n)?n:null}),(e=>{null!=e?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,cn.BY)(this,(()=>{const e=this._activeComputation,t=this._stagedComputation;if(null==e||null!=t){var n;const e=null!==(n=this.view.inputManager.latestPointerType)&&void 0!==n?n:"mouse",t=this._getSnappingContext(e);this._updatingHandles.addPromise((0,St.QZ)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,t)))}if(null!=e){const{start:t,end:n}=this._computationManipulators.get(e);if(t.grabbing||n.grabbing){!function(e,t,n){let{constraint:i,view:r}=n;const{unconstrainedGeometry:s}=e;if(null==s)return;const{renderCoordsHelper:o,spatialReference:a}=r,{startRenderSpace:l,endRenderSpace:c}=s.directSegment,u=o.fromRenderCoords(l,new Xe.A({spatialReference:a})),d=o.fromRenderCoords(c,new Xe.A({spatialReference:a}));let h;h="start"===t?{startPoint:u}:{endPoint:d},Mt(e,h,{constraint:i,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:s,view:r})}(e,t.grabbing?"start":"end",{constraint:this._computeConstraint(e),view:this.view})}}}))}destroy(){var e;this._snappingOperation=(0,l.pR)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),null===(e=this._orientationManipulatorTexture)||void 0===e||e.release()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:e}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=e?e:null}get _stagedComputation(){var e;const t=this._stagedDimension,n=null===(e=this.analysisViewData.computations.at(-1))||void 0===e?void 0:e.computation;return null==t||null==n||n.dimension!==t?null:n}get _constraintHandles(){return[(0,c.z7)((()=>this.analysisViewData.selectedComputation),(e=>{e.previousConstraint=this._computeConstraint(e)}),{...c.pc,equals:gt.aI}),(0,c.wB)((()=>{const e=this._activeComputation;if(null==e)return null;const{measureType:t,orientation:n}=e.dimension;return{measureType:t,orientation:n,computation:e}}),((e,t)=>{if(null!=e&&null==t){const{measureType:t,orientation:n,computation:i}=e;switch(i.previousConstraint){case _t.Horizontal:i.preConstraintProperties={measureType:p.L.Horizontal,orientation:0};break;case _t.Vertical:i.preConstraintProperties={measureType:p.L.Vertical,orientation:0};break;case _t.Direct:i.preConstraintProperties={measureType:p.L.Direct,orientation:n};break;default:i.preConstraintProperties={measureType:t,orientation:n}}}null==e&&null!=t&&(t.computation.preConstraintProperties=null)}),c.OH)]}get _snappingIndicatorHandles(){const e="snapping-indicator-event-handles";return[(0,c.wB)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(t=>{let{stagedComputation:n,activeComputation:i}=t;const r=this._constraintSnappingIndicator;if(this.removeHandles(e),null!=i)if(i===n)r.attached=!0;else{const{start:t,end:n}=this._computationManipulators.get(i),s=()=>{r.attached=t.grabbing||n.grabbing};s(),this.addHandles([t.events.on("grab-changed",s),n.events.on("grab-changed",s)],e)}else r.attached=!1})),(0,c.wB)((()=>{const e=this._activeComputation;return null!=e?{geometry:e.geometry,constraint:e.previousConstraint}:{}}),(e=>{let{geometry:t,constraint:n}=e;const i=this._constraintSnappingIndicator;null!=t&&null!=n&&n!==_t.Direct?(i.visible=!0,i.setGeometryFromSegment(t.directSegment)):i.visible=!1}))]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(e){const{_stagedDimension:t}=this;if(null==t){const t=this._onUnstagedClick(e);return this.analysis.dimensions.add(t),null}return this._onStagedClick(e),t}onPointerMove(e){let{mapPoint:t,pointerType:n}=e;if("touch"===n)return;const i=this._getSnappingContext(n);this._updatingHandles.addPromise((0,St.QZ)(this._snappingOperation.snap({point:t},this._snappingManager,i)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick(e){let{mapPoint:t,pointerType:n}=e,i=t;if("mouse"===n){const e=this._getSnappingContext(n);i=this._snappingManager.update({point:t,context:e})}const r=new mt.A({startPoint:(0,x.EL)(i,new Xe.A),endPoint:null,measureType:p.L.Horizontal});return this._stagedDimension=r,this._resetSnappingState(),r}_onStagedClick(e){let{mapPoint:t,pointerType:n}=e;const i=this._stagedComputation;if(null==i)return;let r=t;if("mouse"===n){const e=this._getSnappingContext(n);r=this._snappingManager.update({point:t,context:e})}const s=(0,x.EL)(r,new Xe.A);this._applyPointUpdate(i,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(e){const t=this._setupPointManipulator(e,{isStart:!0}),n=this._setupPointManipulator(e,{isStart:!1}),i=this._setupOffsetManipulator(e),r=this._setupHeadingManipulator(e),s=this._setupRotationManipulator(e),o=this._setupMeasureTypeManipulator(e,p.L.Direct),a=this._setupMeasureTypeManipulator(e,p.L.Horizontal),l=this._setupMeasureTypeManipulator(e,p.L.Vertical),c=new Ue({start:t,end:n,offset:i,heading:r,rotation:s,direct:o,horizontal:a,vertical:l});return this._setupComputationToManipulatorsSync(e,c),this._computationManipulators.set(e,c),this.manipulators.addMany(c.values()),{manipulators:c,remove:()=>{this._computationHandles.remove(e),this._computationManipulators.delete(e);for(const e of c.values())this.manipulators.remove(e)}}}_setupComputationToManipulatorsSync(e,t){this._computationHandles.add([(0,c.wB)((()=>e.geometry),(()=>this._updateManipulators(e,t)),{...c.pc,equals:gt.aI})],e)}_setupPointManipulator(e,t){const{view:n}=this,{dimension:i}=e,r=new Be(n,{metadata:i}),s=function(e,t){let{isStart:n,createSnappingPipelineStep:i,dimension:r,onUpdate:s,view:o}=t;const a=n?"startPoint":"endPoint",l=(0,Ne.Xt)(e,((e,t,n,l)=>{const c=(0,ze.z7)(e),{snappingStep:u,cancelSnapping:d}=i(l);n=n.next(c).next((0,Ne.VG)(r,[a,"measureType","orientation"])).next(d),t.next(c).next((0,ze.xk)(o)).next(...u).next((e=>{const t=(0,x.EL)(e.mapEnd,new Xe.A);s("startPoint"===a?{startPoint:t}:{endPoint:t})}))}));return[l]}(r,{isStart:t.isStart,createSnappingPipelineStep:e=>Wi({snappingContext:this._getSnappingContext(e),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:i,onUpdate:t=>this._applyPointUpdate(e,t),view:n});return this._computationHandles.add(s,e),r}_setupOffsetManipulator(e){const{view:t}=this,n=function(e,t){const n=[(0,w.fA)(-.5,0,0),(0,w.fA)(.5,0,0)],i=(0,Ve.Z8)(t.unfocusedMaterial,n.map((e=>(0,S.h)((0,w.vt)(),e,.5)))),r=i.instantiate({material:t.focusedMaterial});return new Ae.q({view:e,renderObjects:[new Le.M(i,qe.p7.Unfocused|qe.p7.Selected|ut),new Le.M(r,qe.p7.Focused|ut)],collisionType:{type:"line",paths:[n]},radius:lt(t.lineSizePt)/2,metadata:t.metadata,available:!1,...De.MO})}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),i=function(e,t){let{computation:n,view:i}=t;return[(0,Ne.Xt)(e,((e,t,r)=>{if(!ve(n)||!e.selected)return;const{geometry:s,dimension:o}=n,a=(0,ze.z7)(e);t.next(a).next(Ke(i,o,s.dimensionSegment,s.primaryOffsetAxis)),r.next(a).next((0,Ne.VG)(o,["offset"]))}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupHeadingManipulator(e){const{view:t}=this,n=new We(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=function(e,t){let{computation:n,view:i}=t;return[(0,Ne.Xt)(e,((e,t,r)=>{Qe({cancel:r,computation:n,settingHeading:!0,steps:t,view:i})}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupRotationManipulator(e){const{view:t}=this,n=new We(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=Ye(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupMeasureTypeManipulator(e,t){const{view:n}=this,i=function(e,t){const n=[(0,w.fA)(-.5,0,0),(0,w.fA)(.5,0,0)],i=(0,Ve.Z8)(t.thinOffsetManipulatorMaterial,n),r=(0,Ve.Z8)(t.unfocusedMaterial,n.map((e=>(0,S.h)((0,w.vt)(),e,.5)))),s=r.instantiate({material:t.focusedMaterial});return new Ae.q({view:e,renderObjects:[new Le.M(r,qe.p7.Unfocused|ut),new Le.M(s,qe.p7.Focused|ut),new Le.M(i,ut)],collisionType:{type:"line",paths:[n]},radius:lt(t.lineSizePt)/2,available:!1,metadata:t.metadata,...De.MO})}(n,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),r=Je(i,{computation:e,manipulatorMeasureType:t,view:n});return this._computationHandles.add(r,e),i}_updateManipulators(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator};const{stagedDimension:i,selectedComputation:r,firstGrabbedManipulator:s}=n,{start:o,end:a,offset:l,heading:c,rotation:u}=t,d=r===e,h=ve(e),{dimension:f}=e;for(const p of t.values()){const e=h&&null==i&&(null==s||p===s);p===l?(p.available=e,p.selected=d):p.available=e&&d}if(!h)return;null!=this._computeConstraint(e)?t.forEachMeasureTypeManipulator((e=>e.available=!1)):t.manipulatorForMeasureType(f.measureType).available=!1;for(const v of[c,u])f.measureType===p.L.Direct&&0!==f.offset||(v.available=!1);ce(e)?u.available=!1:c.available=!1;const{geometry:_}=e;o.renderLocation=_.directSegment.startRenderSpace,a.renderLocation=_.directSegment.endRenderSpace;const{renderCoordsHelper:m}=this.view;(function(e,t,n){const{dimensionSegment:i,primaryOffsetAxis:r}=t,s=pe(dt,t),o=(0,S.j)(s,w.uY)?(0,g.D_)(pt):(0,De.wQ)(s,r,w.uY,pt),a=Math.max((0,S.l)(s),.1/n.unitInMeters);(0,g.hs)(o,o,(0,S.s)(dt,a,a,a)),e.modelTransform=o,e.renderLocation=i.eval(.5,dt)})(l,_,m),c.available&&function(e,t,n){tt(e,t,n,{forHeading:!0})}(c,e,m),u.available&&function(e,t,n){tt(e,t,n,{forHeading:!1})}(u,e,m),t.forEachMeasureTypeManipulator(((t,n)=>{t.available&&function(e,t,n,i){const{geometry:r}=t,s=ie(ft,n,t,i),o=ae(dt,{measureType:n,directSegment:r.directSegment,renderCoordsHelper:i}),a=(0,S.z)(ht,s.endRenderSpace,s.startRenderSpace),l=(0,De.wQ)(a,o,w.uY,pt),c=(0,S.l)(a);(0,g.hs)(l,l,(0,S.s)(ht,c,c,c)),e.modelTransform=l,e.renderLocation=s.eval(.5,ht)}(t,e,n,m)}))}_updateManipulatorStyle(e){const t=function(e){return(0,Me.Lz)(e)+4}(e),n=lt(e),i={lineSizePt:e,material:this._orientationManipulatorMaterial};for(const{offset:r,heading:s,rotation:o}of this._computationManipulators.values())r.radius=n/2,s.update(i),o.update(i);this._unfocusedOffsetManipulatorMaterial.setParameters({width:t}),this._focusedOffsetManipulatorMaterial.setParameters({width:n})}_applyPointUpdate(e,t){const{view:n}=this,i=K(e);"startPoint"in t&&(i.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(i.elevationAlignedEndPoint=t.endPoint);const r=ee(i,n.renderCoordsHelper);if(null==r)return;const s=this._computeConstraint({...i,geometry:r});Mt(e,t,{...i,constraint:s,unconstrainedGeometry:r,view:n}),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}_updateStagedDimensionOffset(e){if(null==e.geometry)return;e.geometry.directSegment.eval(.5,tr);const t=this.view.state.camera.computeScreenPixelSizeAt(tr);e.dimension.offset=50*t}_computeConstraint(e){return function(e,t){if(me(e))return _t.Direct;if(!e.enabled)return null;const{geometry:n}=e;if(null==n||(0,S.j)(n.directSegment.startRenderSpace,n.directSegment.endRenderSpace))return null;const{camera:i}=t.state,r=de(b.rq.get(),n,t.renderCoordsHelper),s=he(b.rq.get(),n),o=(0,S.h)(b.rq.get(),r,(0,S.k)(s,r)),a=(0,S.f)(b.rq.get(),s,o),l=(0,S.p)(a),c=(0,S.p)(o),{startRenderSpace:u,endRenderSpace:d}=n.directSegment,h=Math.max(10*i.computeScreenPixelSizeAt(u),10*i.computeScreenPixelSizeAt(d))**2;return l<h?_t.Vertical:c<h?_t.Horizontal:null}(function(e,t){return{enabled:t.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}}(e,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new Ie.W({width:1,renderOccluded:Ze.m$.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get testInfo(){const e=e=>{var t;return null===(t=this.analysisViewData.computations.find((t=>{let{computation:n}=t;return n.dimension===e})))||void 0===t?void 0:t.computation};return{disableManipulatorPartialOcclusion:()=>{this._stagedStartIndicator.renderOccluded=Ze.m$.Occlude,this.manipulators.forEach((e=>{let{manipulator:t}=e;for(const{geometry:n}of t.renderObjects)n.material.setParameters({renderOccluded:Ze.m$.Occlude})}))},getManipulatorsForDimension:t=>this._computationManipulators.get(e(t)),getComputationForDimension:t=>e(t),getConstraintForDimension:t=>{const n=e(t);return null!=n?this._computeConstraint(n):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};(0,r._)([(0,u.MZ)({constructOnly:!0})],er.prototype,"analysis",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],er.prototype,"analysisViewData",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],er.prototype,"manipulators",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],er.prototype,"parentTool",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],er.prototype,"view",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],er.prototype,"updating",null),(0,r._)([(0,u.MZ)()],er.prototype,"firstGrabbedManipulator",null),(0,r._)([(0,u.MZ)()],er.prototype,"hasGrabbedManipulators",null),(0,r._)([(0,u.MZ)()],er.prototype,"snappingOptions",null),(0,r._)([(0,u.MZ)()],er.prototype,"_stagedDimension",void 0),(0,r._)([(0,u.MZ)()],er.prototype,"_activeComputation",null),(0,r._)([(0,u.MZ)()],er.prototype,"_stagedComputation",null),er=(0,r._)([(0,d.$)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],er);const tr=(0,w.vt)();var nr,ir=n(97822),rr=n(82307),sr=n(46576),or=n(11500);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(nr||(nr={}));let ar=class extends ir.k{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,sr.T)(this.view.state.viewingMode),this._lengthDimensionSubTool=new er({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,o.DQ)(this._lengthDimensionSubTool),(0,o.hA)((()=>this._clearPointerMoveTimeout())),(0,c.wB)((()=>this.state),(e=>{e===nr.Created&&this.finishToolCreation()}),c.pc),(0,c.z7)((()=>this.firstGrabbedManipulator),(e=>{this.selectedDimension=e.metadata}),c.pc),(0,c.wB)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),c.pc)])}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?null!=this._activeSubTool?nr.Creating:nr.Created:nr.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(rr.NE.cancel===e.key){if(null!=this._activeSubTool&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else rr.NE.delete.includes(e.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if(null==this._activeSubTool)return;const t=this._intersectScreen(e);null!=t&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);null!=t&&this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_deleteKeyHandler(){null!=this._activeSubTool&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(e){const t=(0,or.sC)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const n=this._intersector.results.min,i=b.rq.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,new Xe.A({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.xt)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((e=>e.manipulator.state|=ut)),this._prevPointerMoveTimeout=ye.p.setTimeout((()=>{this.manipulators.forEach((e=>e.manipulator.state&=~ut))}),this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:e=>{this._pointerMoveTimerMs=e,this._resetPointerMoveTimeout()}}}};(0,r._)([(0,u.MZ)({constructOnly:!0})],ar.prototype,"view",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],ar.prototype,"analysis",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],ar.prototype,"state",null),(0,r._)([(0,u.MZ)({readOnly:!0})],ar.prototype,"updating",null),(0,r._)([(0,u.MZ)({readOnly:!0})],ar.prototype,"cursor",null),(0,r._)([(0,u.MZ)({constructOnly:!0})],ar.prototype,"analysisViewData",void 0),(0,r._)([(0,u.MZ)()],ar.prototype,"selectedDimension",null),(0,r._)([(0,u.MZ)()],ar.prototype,"automaticManipulatorSelection",void 0),(0,r._)([(0,u.MZ)()],ar.prototype,"_activeSubTool",void 0),(0,r._)([(0,u.MZ)()],ar.prototype,"_lengthDimensionSubTool",void 0),ar=(0,r._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionTool")],ar);n(11265);var lr=n(11113),cr=n(11020),ur=n(70667),dr=n(60561);class hr extends xn.X{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=Ze.m$.OccludeAndTransparent,this._width=1,this._color=(0,Ot.fA)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=t,this._hasExternalMaterial=null!=t,this.applyProperties(e)}setGeometryFromSegment(e,t){const n=e.endRenderSpace;this.transform=(0,g.kN)(pr,n),this._normal=t;const{points:i}=e.createRenderGeometry(n,this.view.renderCoordsHelper);this.geometry=[i]}get renderOccluded(){return null!=this._material?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,null!=this._material&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return null!=this._material?this._material.parameters.width:this._width}set width(e){this._width=e,null!=this._material&&this._material.setParameters({width:e})}get color(){return null!=this._material?this._material.parameters.color:this._color}set color(e){this._color=(0,Ot.o8)(e),null!=this._material&&this._material.setParameters({color:this._color})}get placement(){return null!=this._material?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,null!=this._material&&this._material.setParameters({placement:this._placement})}get markerPrimitive(){var e,t;return null!==(e=null===(t=this._material)||void 0===t?void 0:t.parameters.markerPrimitive)&&void 0!==e?e:this._markerPrimitive}set markerPrimitive(e){this._markerPrimitive=e,null!=this._material&&this._material.setParameters({markerPrimitive:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new dr.i({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,ur.z)(this.geometry,this.normal)){const n=(0,ur.t)(this._material,t);e.addGeometry(n)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const pr=(0,y.vt)();class fr{set visible(e){for(const t of this._visualElements.values())t.attached=e}constructor(e){this.destroyed=!1,this._handles=new vt.A,this._messages=null,this._labelSegment=new O.C;const{analysis:t,computation:n,view:i,messages:r,isDecoration:s}=e;this.analysis=t,this.computation=n,this.view=i,this._messages=r;const o=e.visible,a={view:i,attached:o,isDecoration:s},{fontSize:l,textColor:u,textBackgroundColor:d}=t.style;this._visualElements=new gr({marker:new hr(a,e.markerMaterial),dimension:new Pn.t(a,e.dimensionLineMaterial),startOffset:new Pn.t(a,e.offsetLineMaterial),endOffset:new Pn.t(a,e.offsetLineMaterial),dimensionSmall:new Pn.t(a,e.smallDimensionLineMaterial),startOffsetSmall:new Pn.t(a,e.smallOffsetLineMaterial),endOffsetSmall:new Pn.t(a,e.smallOffsetLineMaterial),label:new cr.N({view:i,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,Me.Lz)(l),textColor:u.clone(),backgroundColor:d.clone(),isDecoration:s})}),this._handles.add([(0,c.wB)((()=>n.geometry),(e=>{this.updateCameraDependentElements(i.state.camera,e,t.style),null!=n.geometry&&this._updateLines(n.geometry)}),{...c.Vh,equals:gt.aI}),(0,c.wB)((()=>n.length),(e=>this._updateLabelContent(e)),c.Vh)])}destroy(){this.destroyed=!0,this._handles=(0,l.pR)(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(e){const t=te(_r,ne.Start,e.directSegment,e.dimensionSegment),n=te(mr,ne.End,e.directSegment,e.dimensionSegment),i=this._visualElements;i.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),i.dimension.setGeometryFromSegment(e.dimensionSegment),i.startOffset.setGeometryFromSegment(t),i.endOffset.setGeometryFromSegment(n),i.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),i.startOffsetSmall.setGeometryFromSegment(t),i.endOffsetSmall.setGeometryFromSegment(n)}updateCameraDependentElements(e,t,n){const i=this._visualElements;if(null==t){for(const e of i.values())e.visible=!1;return}const r=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,vr)),s=function(e,t){return(0,S.p)(pe(_e,e))/t**2}(t,r),o=s<(2*(0,Me.Lz)(n.lineSize))**2,a=!o;i.marker.visible=a,i.dimension.visible=a,i.startOffset.visible=a,i.endOffset.visible=a,i.dimensionSmall.visible=o,i.startOffsetSmall.visible=o,i.endOffsetSmall.visible=o;const l=5*(0,Me.Lz)(n.fontSize),{label:c}=i;if(c.visible=s>=l**2,!c.visible)return;const{dimensionSegment:u,primaryOffsetAxis:d}=t,{offset:h}=this.computation.dimension,p=(Math.sign(h)>=0?1:-1)*this._labelOffsetPx(n)*r;(function(e,t,n,i){(0,S.r)(e.startRenderSpace,t.startRenderSpace,n,i),(0,S.r)(e.endRenderSpace,t.endRenderSpace,n,i)})(this._labelSegment,u,d,p),c.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=(0,Me.Lz)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;null!=e&&null!=this._messages?t.text=(0,lr.zJ)(this._messages,e,e.unit):t.text=""}_labelOffsetPx(e){return 1.5*(0,Me.Lz)(e.fontSize)+20+(0,Me.Lz)(e.lineSize/2)}}const _r=new O.C,mr=new O.C,vr=(0,w.vt)();class gr{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var yr=n(50125),Sr=n(38042),wr=n(63860);let Mr=class extends s.A{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(e){super(e),this.loadingMessages=!1,this._messages=null}initialize(){const e=this.isDecoration;this._markerMaterial=new dr.i({width:1,anchor:yr.kJ.Tip,color:be.uY,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:Ze.m$.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:e}),this._dimensionLineMaterial=new Ie.W({width:1,color:be.uY,renderOccluded:Ze.m$.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:e}),this._offsetLineMaterial=new Ie.W({width:1,color:be.uY,renderOccluded:Ze.m$.OccludeAndTransparent,stipplePattern:(0,zn.wk)(5),isDecoration:e}),this._smallDimensionLineMaterial=new Ie.W({width:1,color:be.uY,renderOccluded:Ze.m$.OccludeAndTransparent,isDecoration:e}),this._smallOffsetLineMaterial=new Ie.W({width:1,color:be.uY,renderOccluded:Ze.m$.OccludeAndTransparent,stipplePattern:(0,zn.wk)(5),isDecoration:e});for(const n of this._lineMaterials())this.view._stage.add(n),this.addHandles((0,o.hA)((()=>{var e;null===(e=this.view._stage)||void 0===e||e.remove(n)})));const t=(0,c.LF)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createVisualization(t)}));this._dimensionVisualizations=t,this.addHandles([(0,o.DQ)(t),(0,c.wB)((()=>Se.A.toUnitRGBA(this.analysis.style.color)),(e=>{for(const t of this._lineMaterials())t.setParameters({color:e})}),c.pc),(0,c.wB)((()=>this.analysis.style.lineSize),(e=>{const t=(0,Me.Lz)(e);this._markerMaterial.setParameters({width:.8*t}),this._dimensionLineMaterial.setParameters({width:t,markerParameters:this._markerMaterial.parameters});const n=Math.max(.25*t,1);this._offsetLineMaterial.setParameters({width:n})}),c.pc),(0,c.wB)((()=>({camera:this.view.state.camera,style:br(this.analysis)})),(e=>{let{camera:t,style:n}=e;for(const{visualization:i}of this._dimensionVisualizations)i.updateCameraDependentElements(t,i.computation.geometry,n),i.updateLabelStyle(n)})),(0,c.wB)((()=>this.visible),(e=>{for(const{visualization:t}of this._dimensionVisualizations)t.visible=e}))]),this.addHandles([(0,Sr.oQ)((()=>this._updateMessageBundle())),(0,c.z7)((()=>!this.loadingMessages),(()=>{for(const{visualization:e}of this._dimensionVisualizations)e.updateUnitsMessages(this._messages)}),c.OH)]),this._updateMessageBundle()}get testInfo(){return{visualizations:this._dimensionVisualizations.items.map((e=>{let{visualization:t}=e;return t})),disablePartialOcclusion:()=>{for(const e of this._lineMaterials())e.setParameters({renderOccluded:Ze.m$.Occlude})}}}_createVisualization(e){const t=new fr({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:t,remove:()=>t.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,wr.ud)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function br(e){const{fontSize:t,lineSize:n,textColor:i,textBackgroundColor:r}=e.style;return{fontSize:t,lineSize:n,textBackgroundColor:r.clone(),textColor:i.clone()}}(0,r._)([(0,u.MZ)({constructOnly:!0})],Mr.prototype,"analysisViewData",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Mr.prototype,"view",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],Mr.prototype,"isDecoration",void 0),(0,r._)([(0,u.MZ)()],Mr.prototype,"analysis",null),(0,r._)([(0,u.MZ)()],Mr.prototype,"visible",null),(0,r._)([(0,u.MZ)()],Mr.prototype,"loadingMessages",void 0),Mr=(0,r._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Mr);let Pr=class extends s.A{constructor(e){super(e),this.dimension=null,this.length=null}};(0,r._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Pr.prototype,"dimension",void 0),(0,r._)([(0,u.MZ)()],Pr.prototype,"length",void 0),Pr=(0,r._)([(0,d.$)("esri.views.3d.analysis.LengthDimensionResult")],Pr);const xr=Pr;let Or=class extends s.A{constructor(e){super(e),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(e){const{dimension:t,...n}=e;return{result:new xr({dimension:t}),...n}}initialize(){this.addHandles([(0,c.wB)((()=>this.dimension.startPoint),(e=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(e)),c.pc),(0,c.wB)((()=>this.dimension.endPoint),(e=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(e)),c.pc)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,r._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Or.prototype,"result",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Or.prototype,"projectAndAlignPoint",void 0),(0,r._)([(0,u.MZ)()],Or.prototype,"dimension",null),(0,r._)([(0,u.MZ)()],Or.prototype,"length",null),(0,r._)([(0,u.MZ)()],Or.prototype,"geometry",void 0),(0,r._)([(0,u.MZ)()],Or.prototype,"unconstrainedGeometry",void 0),(0,r._)([(0,u.MZ)()],Or.prototype,"elevationAlignedStartPoint",void 0),(0,r._)([(0,u.MZ)()],Or.prototype,"elevationAlignedEndPoint",void 0),(0,r._)([(0,u.MZ)()],Or.prototype,"preConstraintProperties",void 0),(0,r._)([(0,u.MZ)()],Or.prototype,"previousConstraint",void 0),Or=(0,r._)([(0,d.$)("esri.views.3d.analysis.LengthDimensionComputation")],Or);var Rr=n(17430),Cr=n(10260);const Tr=e=>{let t=class extends e{constructor(){super(...arguments),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new Zn.A}createLengthDimensions(e){throw new Error("Method not implemented.")}};return(0,r._)([(0,u.MZ)({constructOnly:!0})],t.prototype,"view",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,r._)([(0,u.MZ)()],t.prototype,"tool",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],t.prototype,"results",null),(0,r._)([(0,u.MZ)()],t.prototype,"selectedDimension",void 0),(0,r._)([(0,u.MZ)()],t.prototype,"interactive",void 0),(0,r._)([(0,u.MZ)()],t.prototype,"visible",void 0),t=(0,r._)([(0,d.$)("esri.views.analysis.DimensionAnalysisView")],t),t};let Er=class extends(Tr((0,h.P)(s.A))){constructor(e){super(e),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(null==e)return null;const{spatialReference:t,elevationProvider:n}=this.view,i=(0,Rr.B)(e,t,n);return null==i&&(0,Rr.V)(this.analysis,e.spatialReference,a.A.getLogger(this)),i};const e=(0,c.LF)((()=>this.analysis.dimensions),(e=>this._createComputation(e)));this.computations=e,this.addHandles([(0,Cr.Hd)(this,ar),(0,o.DQ)(e)]),this._analysisVisualization=new Mr({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new ge({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,l.DC)(this._placementTask),this._analysisVisualization=(0,l.pR)(this._analysisVisualization),(0,Cr.aS)(this)}get updating(){var e,t;return null!==(e=null===(t=this._analysisVisualization)||void 0===t?void 0:t.loadingMessages)&&void 0!==e&&e}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return null==e?null:this._dimensionsToComputations.get(e)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(e){return this.selectedDimension=null,this._placementTask=(0,l.DC)(this._placementTask),this._placementTask=(0,Cr.JY)(this,e),this._placementTask.promise}_createComputation(e){const{_dimensionsToComputations:t}=this,n=new Or({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return t.set(e,n),{computation:n,remove:()=>this._removeComputation(n)}}_removeComputation(e){const{dimension:t}=e;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}};(0,r._)([(0,u.MZ)({readOnly:!0})],Er.prototype,"type",void 0),(0,r._)([(0,u.MZ)()],Er.prototype,"tool",void 0),(0,r._)([(0,u.MZ)()],Er.prototype,"updating",null),(0,r._)([(0,u.MZ)({readOnly:!0})],Er.prototype,"results",null),(0,r._)([(0,u.MZ)()],Er.prototype,"computations",void 0),(0,r._)([(0,u.MZ)()],Er.prototype,"selectedDimension",void 0),(0,r._)([(0,u.MZ)()],Er.prototype,"selectedComputation",null),(0,r._)([(0,u.MZ)()],Er.prototype,"_analysisVisualization",void 0),(0,r._)([(0,u.MZ)()],Er.prototype,"_analysisController",void 0),(0,r._)([(0,u.MZ)()],Er.prototype,"_dimensionsToComputations",void 0),(0,r._)([(0,u.MZ)()],Er.prototype,"_placementTask",void 0),Er=(0,r._)([(0,d.$)("esri.views.3d.analysis.DimensionAnalysisView3D")],Er);const Ar=Er},85746:(e,t,n)=>{n.d(t,{X:()=>y});var i=n(35143),r=n(91967),s=n(5632),o=n(46053),a=(n(81806),n(76460),n(47249),n(85842)),l=n(57662),c=n(57824),u=n(44513);class d{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=l.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){var t;this._renderGroup=e;const n=null===(t=this._resources)||void 0===t?void 0:t.layerView;n&&(n.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this._resourceFactory.createResources(),n=new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;this._resources={layerView:new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:t,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(n)),this._syncGeometriesToRenderer()}_destroyResources(){var e;if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const t=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!0))}}let h=class extends((0,s.sA)(r.A)){constructor(e){super(e),this.drapeSourceType=l.Om.Features,this.updatePolicy=u.q.SYNC,this.renderGroup=l.O7.Outline}};(0,i._)([(0,o.MZ)({constructOnly:!0})],h.prototype,"view",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],h.prototype,"drapeSourceType",void 0),(0,i._)([(0,o.MZ)()],h.prototype,"renderGroup",void 0),h=(0,i._)([(0,a.$)("DrapedVisualElementLayerView")],h);var p=n(69230),f=n(68134),_=n(87634),m=n(37046),v=n(8918);class g{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==_.X.Mesh&&t.type!==_.X.Line&&t.type!==_.X.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==_.X.Mesh&&t.type!==_.X.Line&&t.type!==_.X.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,n=t._stage;if(!n)return;const i=new v.x(n,{pickable:!1,updatePolicy:u.q.SYNC}),r=new m.B({castShadow:!1}),s=e.createResources(r,i);s.forEach((e=>{n.add(e),e.type===_.X.Texture&&e.load(n.renderView.renderingContext)})),n.add(r),i.add(r);const o=e.cameraChanged,a=o?(0,f.wB)((()=>t.state.camera),(e=>o(e)),f.Vh):null;this._resources={layer:i,object:r,external:s,cameraHandle:a},this._syncVisible()}_destroyResources(){var e;if(null==this._resources)return;const t=this._resourceFactory.view._stage;t&&(t.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((e=>{t.remove(e),e.type===_.X.Texture&&e.unload()}))),this._resources.object.dispose(),null!==(e=this._resources.cameraHandle)&&void 0!==e&&e.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class y extends p.B{constructor(e){var t;super(e),this._isDraped=!1,this.object3dResources=new g(this.createObject3DResourceFactory(e.view)),this.drapedResources=new d(this.createDrapedResourceFactory(e.view)),this.isDraped=null!==(t=e.isDraped)&&void 0!==t&&t}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},47996:(e,t,n)=>{n.d(t,{n:()=>M});var i=n(68134),r=n(34761),s=n(13191),o=n(20664),a=n(9392),l=n(43047),c=n(55855),u=n(75762),d=n(18117),h=n(85746),p=n(33169),f=n(50468),_=n(51799),m=n(62577),v=n(45463),g=n(442),y=n(66470),S=n(76956),w=n(425);class M extends h.X{constructor(e){super(e),this._maxSize=0,this._position=(0,a.vt)(),this._up=(0,a.vt)(),this._right=(0,a.vt)(),this._renderOccluded=v.m$.OccludeAndTransparent,this._color=(0,c.fA)(1,0,0,1),this._outlineColor=(0,c.fA)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=v.m$.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,l.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,l.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:n,next:i}=e;this._maxSize=Math.min((0,o.q)(n,t),(0,o.q)(n,i))/3,(0,o.n)(this._up,(0,o.f)(this._up,t,n)),(0,o.n)(this._right,(0,o.f)(this._right,i,n)),(0,o.c)(this._position,n),this.recreateGeometry()}_createObject3DResources(e){const t=new S.v(this._quadMaterialParameters),n=0===this._outlineSize?void 0:new w.W(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,n),{quadMaterial:t,outlineMaterial:n,forEach:e=>{e(t),n&&e(n)}}}_createObject3DGeometries(e,t,n){if((0,o.j)(this._up,a.uY)&&(0,o.j)(this._right,a.uY))return;const i=this._createGeometries(t,n);for(const r of i)e.addGeometry(r);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new S.v(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new w.W(this._outlineMaterialParameters),n=this._createGeometries(e,t).map((e=>new g.$(e)));return this._setTransformDraped(n),{quadMaterial:e,outlineMaterial:t,geometries:n,pixelRatioHandle:(0,i.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_createGeometries(e,t){const{up:n,right:i,corner:r}=this._getVertices(),s=this._quadGeometryData(n,i,r,e);return t?[s,(0,m.Z8)(t,[n,r,i])]:[s]}_getVertices(){let e=this._up,t=this._right;const n=(0,o.g)(u.rq.get(),e,t);return this.isDraped&&(e=(0,o.c)(u.rq.get(),e),t=(0,o.c)(u.rq.get(),t),e[2]=0,t[2]=0,n[2]=0),{up:e,right:t,corner:n}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object3dResources.object;if(!e)return;const t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),i=Math.min(this._maxSize,n);(0,r.kN)(b,this._position),(0,r.hs)(b,b,[i,i,i]),e.transformation=b}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{_position:i,_size:s}=this,a=(0,o.c)(u.rq.get(),i);a[2]=p.bi;const l=P;l.spatialReference=t.renderer.spatialReference,l.x=a[0],l.y=a[1];const c=s*(this.view.overlayPixelSizeInMapUnits(l)*n),d=Math.min(this._maxSize,c);(0,r.kN)(b,a),(0,r.hs)(b,b,[d,d,1]);for(const r of e)r.transformation=b}_quadGeometryData(e,t,n,i){return new _.V(i,[[y.r.POSITION,new f.n([0,0,0,...t,...e,...n],[0,1,2,1,2,3],3,!0)]])}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.quadMaterial.setParameters(this._quadMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||t.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&null!==(e=e.outlineMaterial)&&void 0!==e&&e.setParameters(this._outlineMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||null===(t=t.outlineMaterial)||void 0===t||t.setParameters(this._outlineMaterialParameters)}}const b=(0,s.vt)(),P=(0,d.T)(0,0,void 0,null)},82307:(e,t,n)=>{n.d(t,{NE:()=>i,fn:()=>r});const i={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},r={toggle:"Control"}},75543:(e,t,n)=>{n.d(t,{FX:()=>j,Mn:()=>w,WG:()=>G,ej:()=>P,en:()=>Z,i7:()=>y});var i=n(18690),r=n(15941),s=n(19555),o=n(72745),a=n(20664),l=n(9392),c=n(43047),u=n(55855),d=(n(63885),n(7137)),h=n(13927),p=n(93582),f=n(94966),_=n(23862),m=n(79337),v=n(74050);class g{intersect(e){return F(this,e)}closestPoints(e){return[this.closestTo(e)]}}class y extends g{constructor(e){super(),this.point=e}equals(e){return this===e||K(e)&&(0,a.j)(this.point,e.point)}closestTo(){return(0,_.o8)(this.point)}}class S extends g{constructor(e,t,n){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:n}}equals(e){return this===e||ee(e)&&this.lineLike.type===e.lineLike.type&&(0,a.j)(this.start,e.start)&&(0,a.j)(this.end,e.end)}closestTo(e){const t=(0,m.Yv)(e,this.lineLike);return(0,_._7)(t)}}class w extends S{constructor(e,t){super(e,t,v.Vv.LINE)}}class M extends S{constructor(e,t){super(e,t,v.Vv.RAY)}}class b extends g{constructor(e){super(),this.constraints=e}equals(e){return this===e||J(e)&&(0,i.aI)(this.constraints,e.constraints,((e,t)=>e.equals(t)))}closestTo(e){let t,n=1/0;for(const i of this.constraints){const r=i.closestTo(e),s=(0,a.a)(e,r);s<n&&(n=s,t=r)}return t?(0,_.o8)(t):e}closestPoints(e){return this.constraints.flatMap((t=>t===this?[]:t.closestPoints(e)))}}class P extends g{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ie(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=(0,m.Nm)(e,this.center,this.radius);return(0,_._7)(t)}}class x extends g{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||re(e)&&(0,a.j)(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=(0,m.Nm)(e,this.center,this.radius);return t[2]=this.center[2],(0,_._7)(t)}asCircle(){return new O((0,_.o8)(this.center),this.radius,(0,_.fA)(0,0,1))}}class O extends g{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;super(),this.center=e,this.radius=t,this.normal=n,this.slicePlane=i}equals(e){return this===e||se(e)&&(0,a.j)(this.center,e.center)&&(0,a.j)(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:n}=this;(0,h._I)(this.getPlane(C),e,R);const i=(0,a.z)(R,R,t),r=(0,a.p)(i);if((0,m.Zj)(r,0))return(0,_.o8)(e);const s=n/Math.sqrt(r),o=(0,a.r)((0,l.vt)(),t,i,s),{slicePlane:c}=this;if(c&&!(0,m.F2)(c,o)){var u;const t=I(c,this);return null!==(u=null===t||void 0===t?void 0:t.closestTo(e))&&void 0!==u?u:(0,_.o8)(e)}return(0,_._7)(o)}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.vt)();return(0,h.O_)(this.center,this.normal,e)}}const R=(0,l.vt)(),C=(0,h.vt)();class T extends g{constructor(e){super(),this.z=e}equals(e){return this===e||te(e)&&this.z===e.z}closestTo(e){return(0,_._7)((0,l.fA)(e[0],e[1],this.z))}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.vt)();return(0,a.s)(E,0,0,this.z),(0,h.O_)(E,l.Cb,e)}}const E=(0,l.vt)();class A extends g{constructor(e,t,n){super(),this.start=e,this.end=t,this.planeLike={start:(0,_.Xz)(e),end:(0,_.Xz)(t),type:n}}equals(e){return this===e||ne(e)&&this.planeLike.type===e.planeLike.type&&(0,a.j)(this.start,e.start)&&(0,a.j)(this.end,e.end)}closestTo(e){return(0,_._7)((0,m.r2)(e,this.planeLike))}closestEndTo(e){const{start:t,end:n}=this.planeLike;return Math.sign((0,s.Om)((0,s.Re)(D,n,t),(0,s.Re)(L,(0,_.Xz)(e),t)))>0?this.end:this.start}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.vt)();const t=(0,a.c)(z,this.end);return t[2]+=1,(0,h.Cr)(this.start,this.end,t,e)}getSlicePlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.vt)();const{start:t,end:n,type:i}=this.planeLike;if(i===m.pJ.PLANE)return;const r=(0,a.s)(z,t[0],t[1],0),s=(0,a.s)(H,n[0],n[1],0),o=(0,a.f)(H,s,r);return(0,h.O_)(r,o,e),e}}const D=(0,o.vt)(),L=(0,o.vt)(),z=(0,l.vt)(),H=(0,l.vt)();class j extends A{constructor(e,t){super(e,t,m.pJ.HALF_PLANE)}}class G extends A{constructor(e,t){super(e,t,m.pJ.PLANE)}}class V extends g{constructor(e,t){super(),this.sphere=(0,p.k)(e,t)}equals(e){return this===e||oe(e)&&(0,p.l)(this.sphere,e.sphere)}closestTo(e){const t=(0,p.p)(this.sphere,e,(0,l.vt)());return(0,_._7)(t)}get center(){return(0,p.g)(this.sphere)}get radius(){return this.sphere[3]}}class Z extends g{constructor(e,t,n){super(),this.start=e,this.end=t,this.getZ=n,this.planeLike={start:(0,_.Xz)(e),end:(0,_.Xz)(t),type:m.pJ.PLANE}}equals(e){return this===e||ae(e)&&(0,a.j)(this.start,e.start)&&(0,a.j)(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){var n;const i=(0,m.r2)(t,e.planeLike);return i[2]=null!==(n=e.getZ(i[0],i[1]))&&void 0!==n?n:le,(0,_._7)(i)}(this,e)}addIfOnTheGround(e,t){for(const i of t){var n;const t=null!==(n=this.getZ(i[0],i[1]))&&void 0!==n?n:0;(0,m.Zj)(i[2],t)&&(i[2]=t,e.push(i))}}}new d.Zj;new d.Zj;function F(e,t){if(J(e)){const n=[];for(const i of e.constraints){const e=i.intersect(t);e&&n.push(e)}return Q(n)}if(J(t))return F(t,e);if(ae(e))return B(e,t);if(ae(t))return B(t,e);if(K(e)){const{point:n}=e;if(K(t))return(0,a.j)(n,t.point)?e:void 0;const i=t.closestTo(n);return(0,a.G)(i,n)?e:void 0}if(ee(e)){if(K(t))return F(t,e);if(ee(t))return $((0,m.SO)(e.lineLike,t.lineLike));if(te(t))return k(e,t);if(ne(t))return $((0,m.Mc)(t.planeLike,e.lineLike));if(ie(t))return $((0,m.K4)(e.lineLike,t.center,t.radius));if(se(t))return $((0,m.IB)(e.lineLike,t));if(re(t))return function(e,t){let{lineLike:n}=e,{center:i,radius:r}=t;const s=i[2];return $((0,m.K4)(n,i,r).filter((e=>(0,m.Zj)(e[2],s))))}(e,t);if(oe(t))return function(e,t){let{lineLike:n}=e,{sphere:i}=t;return $((0,p.m)(i,n.start,n.end))}(e,t)}else if(te(e)){if(K(t)||ee(t))return F(t,e);if(te(t))return function(e,t){return(0,m.Zj)(e.z,t.z)?e:void 0}(e,t);if(ne(t))return function(e,t){let{z:n}=e,{planeLike:i}=t;const[r,s]=i.start,[o,a]=i.end,l=(0,_.fA)(r,s,n),c=(0,_.fA)(o,a,n);return i.type===m.pJ.PLANE?new w(l,c):new M(l,c)}(e,t);if(ie(t))return function(e,t){const[n,i]=t.center;return new x((0,_.fA)(n,i,e.z),t.radius)}(e,t);if(se(t))return N(e,t);if(re(t))return function(e,t){return(0,m.Zj)(t.center[2],e.z)?t:void 0}(e,t);if(oe(t))return function(e,t){let{center:n,radius:i}=t;const r=Math.abs(n[2]-e.z);if(r>i&&!(0,m.Zj)(r,i))return;const s=(0,_.fA)(n[0],n[1],e.z),o=Math.sqrt(i**2-r**2);return(0,m.Zj)(o,0)?void 0:new x(s,o)}(e,t)}else if(ne(e)){if(K(t)||ee(t)||te(t))return F(t,e);if(ne(t))return W((0,m.b_)(e.planeLike,t.planeLike));if(ie(t))return W((0,m.Bn)(e.planeLike,t.center,t.radius));if(se(t))return X(e,t);if(re(t))return q(e,t);if(oe(t))return U(e,t)}else if(ie(e)){if(K(t)||ee(t)||te(t)||ne(t))return F(t,e);if(ie(t))return W((0,m.t1)((0,_.Xz)(e.center),e.radius,(0,_.Xz)(t.center),t.radius));if(se(t))return;if(re(t))return function(e,t){const n=(0,s.hG)((0,_.Xz)(e.center),(0,_.Xz)(t.center));return(0,m.Zj)(n,0)&&(0,m.Zj)(e.radius,t.radius)?t:Y((0,m.t1)((0,_.Xz)(e.center),e.radius,(0,_.Xz)(t.center),t.radius),t.center[2])}(e,t);if(oe(t))return}else if(se(e)){if(K(t)||ee(t)||te(t)||ne(t)||ie(t))return F(t,e);if(se(t))return;if(re(t))return void t.asCircle();if(oe(t))return}else if(re(e)){if(K(t)||ee(t)||te(t)||ne(t)||ie(t)||se(t))return F(t,e);if(re(t))return function(e,t){if(!(0,m.HG)(e.center,t.center))return;const n=(0,s.hG)((0,_.Xz)(e.center),(0,_.Xz)(t.center));return(0,m.Zj)(n,0)&&(0,m.Zj)(e.radius,t.radius)?e:Y((0,m.t1)((0,_.Xz)(e.center),e.radius,(0,_.Xz)(t.center),t.radius),e.center[2])}(t,e);if(oe(t))return}else if(oe(e)){if(K(t)||ee(t)||te(t)||ne(t)||ie(t)||re(t))return F(t,e);if(oe(t))return}}const k=(()=>{const e=(0,h.vt)();return(t,n)=>{const{start:i,end:r}=t;if((0,m.HG)(i,r)&&(0,m.Zj)(i[2],n.z))return t;const s=(0,l.vt)();return(0,h.U5)(n.getPlane(e),i,r,s)?new y((0,_._7)(s)):void 0}})();const I=(()=>{const e=(0,u.vt)(),t=(0,l.vt)(),n=(0,l.vt)();return(i,s,o)=>{const{normal:u,center:d,radius:p}=s;(0,f.VV)(u,t,n);const v=(0,h.Qj)(i),g=p*(0,a.k)(v,t),S=p*(0,a.k)(v,n);(0,c.s)(e,d[0],d[1],d[2],1);const w=(0,c.g)(i,e),M=Math.hypot(g,S),b=(0,m.Zj)(M,0);if((0,m.Zj)((0,h.Io)(i,d),0)){if(b)return s;if((0,m.Zj)(p,0))return!o||(0,m.F2)(o,d)?new y((0,_.o8)(d)):void 0;(0,a.b)(t,v,u),(0,a.n)(t,t);const e=new Array,n=(0,l.o8)(d);(0,a.r)(n,n,t,p),o&&!(0,m.F2)(o,n)||e.push(n);const i=(0,l.o8)(d);return(0,a.r)(i,i,t,-p),o&&!(0,m.F2)(o,i)||e.push(i),$(e)}if(b)return;const P=-w/M;if(Math.abs(P)>1||(0,m.Zj)(P,1))return;const x=Math.atan(g/S),O=(0,r.YN)(P)-x,R=Math.PI-O,C=new Array,T=(0,l.vt)();(0,a.r)(T,d,t,p*Math.cos(O)),(0,a.r)(T,T,n,p*Math.sin(O)),C.push(T);const E=(0,l.vt)();return(0,a.r)(E,d,t,p*Math.cos(R)),(0,a.r)(E,E,n,p*Math.sin(R)),C.push(E),$(o?(0,m.UL)(o,C):C)}})();const N=(()=>{const e=(0,h.vt)();return(t,n)=>I(t.getPlane(e),n,n.slicePlane)})();const q=(()=>{const e=(0,h.vt)();return(t,n)=>{let{center:i,radius:r}=n;const s=(0,m.Bn)(t.planeLike,i,r),o=i[2];t.getSlicePlane(e);const a=new Array;for(const[l,c]of s){const t=[l,c,o];(0,m.F2)(e,t)&&a.push(t)}return $(a)}})(),X=(()=>{const e=(0,h.vt)(),t=(0,h.vt)();return(n,i)=>I(n.getPlane(e),i,n.getSlicePlane(t))})(),U=(()=>{const e=(0,h.vt)();return(t,n)=>{let{center:i,radius:r}=n;const s=t.getPlane(e),o=(0,h.mN)(s,i),c=Math.abs(o);if(c>r&&!(0,m.Zj)(c,r))return;const u=(0,l.o8)((0,h.Qj)(s)),d=(0,a.r)((0,l.vt)(),i,u,o),p=Math.sqrt(r**2-o**2);return(0,m.Zj)(p,0)?new y((0,_._7)((0,h._I)(s,i,(0,l.vt)()))):new O((0,_._7)(d),p,u,t.getSlicePlane())}})();function B(e,t){const{planeLike:n,getZ:i}=e,r=new Array;if(K(t))e.addIfOnTheGround(r,(0,m.VT)(n,t.point));else if(ee(t))e.addIfOnTheGround(r,(0,m.Mc)(n,t.lineLike));else if(ie(t))for(const[o,a]of(0,m.Bn)(n,t.center,t.radius)){const e=i(o,a);null!=e&&r.push((0,l.fA)(o,a,e))}else if(ne(t)||ae(t))for(const[o,a]of(0,m.b_)(n,t.planeLike)){var s;const e=null!==(s=i(o,a))&&void 0!==s?s:le;r.push((0,l.fA)(o,a,e))}return $(r)}function W(e){return Q(e.map((e=>{let[t,n]=e;const i=(0,_.fA)(t,n,0),r=(0,_.fA)(t,n,1);return new w(i,r)})))}function $(e){return Q(e.map((e=>e?new y((0,_._7)(e)):void 0)))}function Y(e,t){return $(e.map((e=>{let[n,i]=e;return[n,i,t]})))}function Q(e){var t;if(0!==e.length)return 1===e.length?null!==(t=e[0])&&void 0!==t?t:void 0:new b(e.filter(i.Ru))}function J(e){return e instanceof b}function K(e){return e instanceof y}function ee(e){return e instanceof S}function te(e){return e instanceof T}function ne(e){return e instanceof A}function ie(e){return e instanceof P}function re(e){return e instanceof x}function se(e){return e instanceof O}function oe(e){return e instanceof V}function ae(e){return e instanceof Z}const le=0},23862:(e,t,n)=>{n.d(t,{Lp:()=>d,Xz:()=>l,_7:()=>a,fA:()=>c,io:()=>p,o8:()=>u,vf:()=>h,vt:()=>o,xF:()=>f});var i=n(9392),r=n(18117),s=n(12482);function o(e,t,n){return(0,i.fA)(e,t,n)}function a(e){return e}function l(e){return e}function c(e,t,n){return(0,i.fA)(e,t,n)}function u(e){return(0,i.o8)(e)}function d(e,t,n){let{coordinateHelper:i,elevationInfo:r}=n;return e?h(i.vectorToDehydratedPoint(e,_),t,r):null}function h(e,t,n){var r,o;if(null==e)return null;if(null==t)return(0,i.fA)(e.x,e.y,null!==(r=e.z)&&void 0!==r?r:0);if("2d"===t.type)return(0,i.fA)(e.x,e.y,0);const a=null!==(o=(0,s.wS)(t,e,n,s.qt))&&void 0!==o?o:0;return(0,i.fA)(e.x,e.y,a)}function p(e,t){return(0,r.T)(e[0],e[1],e[2],t)}function f(e,t,n,i){let{z:o,m:a}=n;const{spatialReference:l,elevationInfo:c}=i;let u;if(null==o&&null==a)u=void 0;else if(null==t||"2d"===t.type)u=null!==o&&void 0!==o?o:void 0;else{var d;u=null!==(d=(0,s.xS)(t,e,l,s.qt,c))&&void 0!==d?d:0}const h=(0,r.T)(e[0],e[1],u,l);return null!=a&&(h.m=a,h.hasM=!0),h}const _=(0,r.T)(0,0,0,null)},99791:(e,t,n)=>{var i;n.d(t,{n:()=>i}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(i||(i={}))},80794:(e,t,n)=>{n.d(t,{X:()=>a});var i=n(75543),r=n(9730),s=n(61751),o=n(23543);class a extends s.w{constructor(e){super({...e,isDraped:!0,constraint:new i.en(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.c(r.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},9876:(e,t,n)=>{n.d(t,{z:()=>a});var i=n(75543),r=n(9730),s=n(61751),o=n(23543);class a extends s.w{constructor(e){super({...e,constraint:new i.Mn(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.c(r.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},61751:(e,t,n)=>{n.d(t,{w:()=>s});var i=n(99791),r=n(30003);class s extends r.C{constructor(e){let{targetPoint:t,objectId:n,constraint:r,isDraped:s}=e;super(t,r,s,i.n.FEATURE),this.objectId=n}}},30003:(e,t,n)=>{n.d(t,{C:()=>i});class i{constructor(e,t,n,i){this.targetPoint=e,this.constraint=t,this.isDraped=n,this.domain=i}}},23543:(e,t,n)=>{n.d(t,{c:()=>o});n(81806),n(76460);var i=n(20664),r=n(99791),s=n(64753);class o extends s.m{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.n.ALL,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(i,s),this.type=e,this.lineStart=t,this.lineEnd=n,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof o&&this.type===e.type&&(0,i.j)(this.lineStart,e.lineStart)&&(0,i.j)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,i.q)(this.lineStart,this.lineEnd)}}},23241:(e,t,n)=>{n.d(t,{_:()=>s});var i=n(20664),r=n(64753);class s extends r.m{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof s&&(0,i.j)(this.point,e.point)}}},64753:(e,t,n)=>{n.d(t,{m:()=>i});class i{constructor(e,t){this.isDraped=e,this.domain=t}}},9730:(e,t,n)=>{n.d(t,{H3:()=>i,is:()=>g,Tu:()=>M,HN:()=>y,nf:()=>v,Mo:()=>_,BY:()=>w,xX:()=>m,pM:()=>f});var i,r=n(68134),s=n(41289),o=n(34154),a=n(18288),l=n(20664),c=n(18117),u=n(97015),d=n(88847),h=n(82307),p=n(23862);function f(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function _(e,t){return Math.sqrt(f(e,t))}function m(e,t){t.sort(((t,n)=>(0,l.a)(t.targetPoint,e)-(0,l.a)(n.targetPoint,e)))}function v(e,t,n){let{point:i,distance:r,returnEdge:l,vertexMode:d,coordinateHelper:{spatialReference:h},filter:p}=e;return n=null!=n?n.clone():new u.A({where:"1=1"}),p&&(n.geometry=p.geometry,n.distance=p.distance,n.spatialRelationship=p.spatialRelationship,n.where=(0,o.m)(n.where,p.where),n.timeExtent=(0,a.pJ)(n.timeExtent,p.timeExtent),n.objectIds=function(e,t){return e||t?t?e?Array.from((0,s.E$)(new Set(e),new Set(t))):t:e:null}(n.objectIds,p.objectIds)),{point:(0,c.T)(i[0],i[1],i[2],h.toJSON()),mode:t,distance:r,returnEdge:l,vertexMode:d,query:n.toJSON()}}function g(e,t,n){return{left:(0,p.Lp)(e.leftVertex.pos,t,n),right:(0,p.Lp)(e.rightVertex.pos,t,n)}}function y(e){return e.createQuery()}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(i||(i={}));const S=Symbol("snapping-toggle");function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};const n=(0,r.wB)((()=>({view:e.view,snappingOptions:e.snappingOptions})),(n=>{let{view:i,snappingOptions:r}=n;if(e.removeHandles(S),!i||!r)return;const s=d.o.TOOL,o=[i.on("key-down",(e=>{e.key!==h.fn.toggle||e.repeat||(r.enabledToggled=!0,t())}),s),i.on("key-up",(e=>{e.key===h.fn.toggle&&(r.enabledToggled=!1,t())}),s),i.on("pointer-move",(e=>{const n=e.native.ctrlKey;r.enabledToggled!==n&&(r.enabledToggled=n,t())}),s)];e.addHandles(o,S)}),r.pc);e.addHandles(n)}function M(e){var t;return function(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass}(e)&&"utilityNetworks"in e&&!(null===(t=e.utilityNetworks)||void 0===t||!t.length)}},90659:(e,t,n)=>{n.d(t,{M:()=>s,U:()=>o});var i=n(7137),r=n(80963);function s(e,t,n,s){for(var o=arguments.length,a=new Array(o>4?o-4:0),l=4;l<o;l++)a[l-4]=arguments[l];return(0,r.EA)(e)&&(0,i.TT)(e)?t.apply(void 0,a):(0,r.K8)(e)?n.apply(void 0,a):s.apply(void 0,a)}const o=1e5},79337:(e,t,n)=>{n.d(t,{Bn:()=>h,F2:()=>R,HG:()=>P,IB:()=>y,K4:()=>S,Mc:()=>p,Nm:()=>v,SO:()=>w,UL:()=>O,VT:()=>f,Yv:()=>g,Zj:()=>x,b_:()=>_,pJ:()=>C,r2:()=>m,t1:()=>M});var i=n(15941),r=n(19555),s=n(72745),o=n(20664),a=n(9392),l=n(53494),c=n(13927),u=n(94966),d=n(74050);function h(e,t,n){let{start:i,end:o,type:a}=e;const l=[],c=(0,r.Re)(E,o,i),u=(0,r.Re)(A,i,t),d=(0,r.m3)(c),h=2*(0,r.Om)(c,u),p=h*h-4*d*((0,r.m3)(u)-n*n);if(0===p){const e=-h/(2*d);(a===C.PLANE||e>=0)&&l.push((0,r.Ln)((0,s.vt)(),i,c,e))}else if(p>0){const e=Math.sqrt(p),t=(-h+e)/(2*d);(a===C.PLANE||t>=0)&&l.push((0,r.Ln)((0,s.vt)(),i,c,t));const n=(-h-e)/(2*d);(a===C.PLANE||n>=0)&&l.push((0,r.Ln)((0,s.vt)(),i,c,n))}return l}function p(e,t){const n=e.start,i=e.end,s=(0,r.Re)(E,i,n),c=(0,o.s)(L,-s[1],s[0],0),u=t.start,h=t.end,p=(0,o.z)(z,h,u),f=(0,o.k)(p,c),_=(0,o.s)(H,n[0],n[1],0),m=(0,o.z)(j,_,u),v=(0,o.k)(m,c),g=(0,l.FD)();if(Math.abs(f)<g)return Math.abs(v),[];const y=(0,o.r)(G,u,p,v/f);if(t.type===d.Vv.RAY){const e=(0,o.z)(V,y,u);if((0,o.k)(e,p)<-g)return[]}if(e.type===C.HALF_PLANE){const e=(0,r.jb)(A,y,n);if((0,r.Om)(e,s)<-g)return[]}return[(0,a.o8)(y)]}function f(e,t){return function(e,t){let{start:n,end:i,type:r}=e;const s=(0,o.z)(D,t,n),c=(0,o.z)(L,i,n),u=(0,o.b)(z,c,s),h=(0,o.x)(u)/(0,o.x)(c),p=(0,l.FD)();if(h<p)switch(r){case d.Vv.LINE:return[(0,a.o8)(t)];case d.Vv.RAY:return(0,o.k)(c,s)<-p?[]:[(0,a.o8)(t)]}return[]}(b(F,t[2],e),t)}function _(e,t){return w(b(F,0,e),b(k,0,t)).map((e=>{let[t,n]=e;return(0,s.fA)(t,n)}))}function m(e,t){return g(e,b(F,e[2],t))}function v(e,t,n){const i=(0,r.Re)(E,e,t),s=(0,r.Bw)(i),o=0===s?1:n/s,l=(0,a.vt)();return(0,r.Ln)(l,t,i,o),l[2]=e[2],l}function g(e,t){let{start:n,end:i,type:r}=t,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,a.vt)();const l=(0,o.z)(D,e,n),c=(0,o.z)(L,i,n),u=(0,o.k)(l,c)/(0,o.k)(c,c);return(0,o.r)(s,n,c,r===d.Vv.RAY?Math.max(u,0):u)}const y=(()=>{const e=(0,a.vt)(),t=(0,a.vt)(),n=(0,a.vt)();return(i,l)=>{let{start:h,end:p}=i,{center:f,radius:_,normal:m,slicePlane:v}=l;const g=(0,c.O_)(f,m,Z);if(x((0,c.Io)(g,h),0)&&x((0,c.Io)(g,p),0)){(0,u.VV)(m,e,t);const i=(i,s)=>((0,o.f)(n,s,f),(0,r.hZ)(i,(0,o.k)(n,e),(0,o.k)(n,t)),i),l=(0,d.IB)({start:i(E,h),end:i(A,p),type:d.Vv.LINE},s.uY,_),c=[];for(const[n,r]of l){const i=(0,o.c)((0,a.vt)(),f);(0,o.r)(i,i,e,n),(0,o.r)(i,i,t,r),v&&!R(v,i)||c.push(i)}return c}const y=(0,a.vt)();return(0,c.U5)(g,h,p,y)?!x((0,o.q)(y,f),_)||v&&!R(v,y)?[]:[y]:[]}})();function S(e,t,n){let{start:i,end:s,type:l}=e;const c=[],u=(0,o.f)(D,s,i),h=(0,r.Re)(A,i,t),p=(0,r.m3)(u),f=2*(0,r.Om)(u,h),_=f*f-4*p*((0,r.m3)(h)-n*n);if(0===_){const e=-f/(2*p);(l===d.Vv.LINE||e>=0)&&c.push((0,o.r)((0,a.vt)(),i,u,e))}else if(_>0){const e=Math.sqrt(_),t=(-f+e)/(2*p);(l===d.Vv.LINE||t>=0)&&c.push((0,o.r)((0,a.vt)(),i,u,t));const n=(-f-e)/(2*p);(l===d.Vv.LINE||n>=0)&&c.push((0,o.r)((0,a.vt)(),i,u,n))}return c}function w(e,t){const n=e.start,i=e.end,r=t.start,s=t.end,c=(0,o.z)(D,i,n),u=(0,o.z)(L,s,r),h=(0,o.z)(z,r,n),p=(0,o.b)(H,c,u);if(!x((0,o.k)(h,p),0))return[];const f=(0,o.x)(p);if(x(f,0))return[];const _=(0,o.b)(j,h,u),m=(0,o.k)(_,p)/f,v=(0,o.r)(G,n,c,m);if(e.type===d.Vv.RAY){const e=(0,o.z)(V,v,n);if((0,o.k)(c,e)<-(0,l.FD)())return[]}if(t.type===d.Vv.RAY){const e=(0,o.z)(V,v,r);if((0,o.k)(u,e)<-(0,l.FD)())return[]}return[(0,a.o8)(v)]}function M(e,t,n,i){const[o,a]=e,[l,c]=n,u=l-o,d=c-a,h=u*u+d*d,p=Math.sqrt(h);if(p>t+i)return[];if(p<Math.abs(t-i))return[];if(x(p,0)&&x(t,i))return[];const f=(t*t-i*i+h)/(2*p),_=Math.sqrt(t*t-f*f),m=_*d/p,v=_*u/p,[g,y]=(0,r.Cc)(E,e,n,f/p);return x(m,v)?[(0,s.fA)(g,y)]:[(0,s.fA)(g+m,y-v),(0,s.fA)(g-m,y+v)]}function b(e,t,n){let{start:i,end:r,type:s}=n;return(0,o.s)(e.start,i[0],i[1],t),(0,o.s)(e.end,r[0],r[1],t),e.type=T[s],e}function P(e,t){return x(e[2],t[2])}function x(e,t){return(0,i.Sp)(Math.abs(e-t),0,(0,l.FD)())}function O(e,t){return t.filter((t=>R(e,t)))}function R(e,t){return(0,c.Tj)(e,t)}var C;!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(C||(C={}));const T={[C.PLANE]:d.Vv.LINE,[C.HALF_PLANE]:d.Vv.RAY},E=(0,s.vt)(),A=(0,s.vt)(),D=(0,a.vt)(),L=(0,a.vt)(),z=(0,a.vt)(),H=(0,a.vt)(),j=(0,a.vt)(),G=(0,a.vt)(),V=(0,a.vt)(),Z=(0,c.vt)(),F={start:(0,a.vt)(),end:(0,a.vt)(),type:d.Vv.LINE},k={start:(0,a.vt)(),end:(0,a.vt)(),type:d.Vv.LINE}}}]);
//# sourceMappingURL=9831.076222b4.chunk.js.map