{"version":3,"file":"static/js/4063.78bd5bb1.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/arrayUtils.js\";import{isArrayBuffer as r}from\"../../../core/typedArrayUtil.js\";import{conjugate as e}from\"../../../core/libs/gl-matrix-2/math/quat.js\";import{create as a}from\"../../../core/libs/gl-matrix-2/factories/quatf64.js\";import{u as o}from\"../../../chunks/vec32.js\";import{clone as i,create as f}from\"../../../core/libs/gl-matrix-2/factories/vec3f32.js\";import n from\"../../../geometry/SpatialReference.js\";import{projectBuffer as s}from\"../../../geometry/projection/projectBuffer.js\";import{readGeometry as u,getAttributeValues as l,evaluateRenderer as m,filterInPlace as b}from\"./i3s/PointCloudWorkerUtil.js\";import{Obb as p}from\"../support/orientedBoundingBox.js\";class c{transform(t){const e=this._transform(t),a=[e.points.buffer,e.rgb.buffer];null!=e.pointIdFilterMap&&a.push(e.pointIdFilterMap.buffer);for(const o of e.attributes)\"buffer\"in o.values&&r(o.values.buffer)&&o.values.buffer!==e.rgb.buffer&&a.push(o.values.buffer);return Promise.resolve({result:e,transferList:a})}_transform(r){const e=u(r.schema,r.geometryBuffer);let a=e.length/3,o=null;const i=new Array,f=l(r.primaryAttributeData,e,a);null!=r.primaryAttributeData&&f&&i.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:f});const s=l(r.modulationAttributeData,e,a);null!=r.modulationAttributeData&&s&&i.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:s});let c=m(r.rendererInfo,f,s,a);if(r.filterInfo&&r.filterInfo.length>0&&null!=r.filterAttributesData){const f=r.filterAttributesData.filter(t).map((t=>{const r=l(t,e,a),o={attributeInfo:t.attributeInfo,values:r};return i.push(o),o}));o=new Uint32Array(a),a=b(e,c,o,r.filterInfo,f)}for(const t of r.userAttributesData){const r=l(t,e,a);i.push({attributeInfo:t.attributeInfo,values:r})}3*a<c.length&&(c=new Uint8Array(c.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(e,a,r.elevationOffset);const h=this._transformCoordinates(e,a,p.fromData(r.obbData),n.fromJSON(r.inSR),n.fromJSON(r.outSR));return{obbData:r.obbData,points:h,rgb:c,attributes:i,pointIdFilterMap:o}}_transformCoordinates(t,r,a,n,u){if(!s(t,n,0,t,u,0,r))throw new Error(\"Can't reproject\");const l=i(a.center),m=f(),b=f(),p=i(a.halfSize);e(h,a.quaternion);const c=new Float32Array(3*r);for(let e=0;e<r;e++){let r=3*e;m[0]=t[r]-l[0],m[1]=t[r+1]-l[1],m[2]=t[r+2]-l[2],o(b,m,h),p[0]=Math.max(p[0],Math.abs(b[0])),p[1]=Math.max(p[1],Math.abs(b[1])),p[2]=Math.max(p[2],Math.abs(b[2])),c[r++]=m[0],c[r++]=m[1],c[r]=m[2]}return a.halfSize=p,c}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const h=a();function I(){return new c}export{I as default};\n"],"names":["c","transform","t","e","this","_transform","a","points","buffer","rgb","pointIdFilterMap","push","o","attributes","values","r","Promise","resolve","result","transferList","u","schema","geometryBuffer","length","i","Array","f","l","primaryAttributeData","attributeInfo","s","modulationAttributeData","m","rendererInfo","filterInfo","filterAttributesData","filter","map","Uint32Array","b","userAttributesData","Uint8Array","slice","_applyElevationOffsetInPlace","elevationOffset","h","_transformCoordinates","p","fromData","obbData","n","fromJSON","inSR","outSR","Error","center","halfSize","quaternion","Float32Array","Math","max","abs","I"],"sourceRoot":""}