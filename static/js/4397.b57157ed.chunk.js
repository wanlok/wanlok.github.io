"use strict";(self.webpackChunkwanlok_component_react=self.webpackChunkwanlok_component_react||[]).push([[4397],{84397:(e,t,r)=>{r.r(t),r.d(t,{default:()=>re});var i=r(89379),o=r(35143),a=r(3825),s=r(69098),n=r(19276),l=r(50076),d=r(77717),p=r(50346),u=r(90534),y=r(46053),c=(r(81806),r(76460)),h=(r(47249),r(85842)),f=r(25515),m=r(54901),v=r(53521),g=r(87663),_=r(65624),b=r(5682),w=r(55053),I=r(62487),M=r(51162),j=r(65308),L=r(70652),A=r(72003);class Z{constructor(e,t){this.objectId=e,this.itemSource=t,this.count=0,this.layer=null,this.sortValue=void 0}}const F=new v.q(20,(e=>e.destroy()));let T=class extends((0,b.j)((0,_.d)((0,d.P)(f.A)))){constructor(e){super(e),this._oidToReference=new Map,this._layerToReference=new Map,this._portals=new Map,this.layers=new n.A,this.maximumVisibleSublayers=10,this.opacity=1,this.title="Layers In View",this.type="catalog-dynamic-group",this.visible=!0}load(e){return this.addResolvingPromise(this.parent.load()),Promise.resolve(this)}get _orderBy(){var e,t;return null!==(e=null===(t=this.parent.orderBy)||void 0===t?void 0:t.find((e=>!e.valueExpression&&e.field)))&&void 0!==e?e:new M.A({field:this.parent.objectIdField})}get _referenceComparator(){const e=this._orderBy,t=this.parent.fieldsIndex.get(e.field),r=(0,A.FM)(null===t||void 0===t?void 0:t.toJSON().type,"descending"===e.order);return(e,t)=>r(e.sortValue,t.sortValue)||e.objectId-e.objectId}acquireLayer(e){const t=e.getObjectId(),r=(0,g.tE)(this._oidToReference,t,(()=>this._createLayerReference(e)));return r.count++,(0,m.hA)((()=>{r.count--,r.count||this._disposeLayerReference(r)}))}_createLayerReference(e){const t=e.getObjectId(),r=e.getAttribute(this.parent.itemSourceField),i=new Z(t,r);if(F.get(r))return this._addLayer(F.pop(r),i,e),i;let o;try{o=JSON.parse(r)}catch(a){return c.A.getLogger(this).error(a),i}return this._createLayer(o).then((t=>{this.destroyed||0===i.count?(F.get(r)||F.put(i.itemSource,t),i.layer=null):this._addLayer(t,i,e)})).catch((()=>{})),i}_addLayer(e,t,r){this._layerToReference.set(e,t),t.sortValue=r.getAttribute(this._orderBy.field),t.layer=e,e.parent=this,this.layers.add(e),this.layers.sort(((e,t)=>this._referenceComparator(this._layerToReference.get(e),this._layerToReference.get(t))))}_disposeLayerReference(e){e.layer&&(this._layerToReference.delete(e.layer),this.layers.remove(e.layer),F.put(e.itemSource,e.layer)),this._oidToReference.delete(e.objectId)}async _createLayer(e){if(!function(e){return"object"==typeof e&&null!=e&&"itemId"in e&&"portalUrl"in e}(e))return new(await I.S.UnsupportedLayer());const{itemId:t,portalUrl:r}=e,i=(0,g.tE)(this._portals,r,(()=>new j.A({url:r})));return f.A.fromPortalItem(new L.default({id:t,portal:i}))}};(0,o._)([(0,y.MZ)()],T.prototype,"_orderBy",null),(0,o._)([(0,y.MZ)()],T.prototype,"_referenceComparator",null),(0,o._)([(0,y.MZ)({readOnly:!0})],T.prototype,"layers",void 0),(0,o._)([(0,y.MZ)()],T.prototype,"maximumVisibleSublayers",void 0),(0,o._)([(0,y.MZ)(w.ke)],T.prototype,"opacity",void 0),(0,o._)([(0,y.MZ)({type:String,json:{name:"title",write:!0}})],T.prototype,"title",void 0),(0,o._)([(0,y.MZ)({json:{read:!1}})],T.prototype,"type",void 0),(0,o._)([(0,y.MZ)({type:Boolean,json:{name:"visibility",write:!0}})],T.prototype,"visible",void 0),T=(0,o._)([(0,h.$)("esri.layers.catalog.CatalogDynamicGroupLayer")],T);const P=T;var S=r(16868),x=(r(63844),r(14873),r(47662),r(72690),r(86946),r(71832),r(5766),r(35039),r(86616),r(31382)),R=r(74440),O=r(71401),C=r(27937),V=r(30973);let q=class extends((0,b.j)((0,R.F)((0,_.d)((0,d.P)(f.A))))){constructor(e){super(e),this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.opacity=1,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.type="catalog-footprint",this.visible=!0}load(e){return this.addResolvingPromise(this.parent.load()),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get fields(){return this.parent.fields}get fieldsIndex(){return this.parent.fieldsIndex}get geometryType(){return this.parent.geometryType}get objectIdField(){return this.parent.objectIdField}get orderBy(){return this.parent.orderBy}createPopupTemplate(e){const t={fields:this.parent.fields,objectIdField:this.parent.objectIdField,title:this.title};return(0,V.tn)(t,e)}createQuery(){return this.parent.createQuery()}queryFeatures(e,t){return this.parent.queryFeatures(e,t)}};(0,o._)([(0,y.MZ)({readOnly:!0})],q.prototype,"defaultPopupTemplate",null),(0,o._)([(0,y.MZ)({type:[O.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:C.w,write:!0}})],q.prototype,"labelingInfo",void 0),(0,o._)([(0,y.MZ)(w.kF)],q.prototype,"labelsVisible",void 0),(0,o._)([(0,y.MZ)(w.fV)],q.prototype,"legendEnabled",void 0),(0,o._)([(0,y.MZ)(w.ke)],q.prototype,"opacity",void 0),(0,o._)([(0,y.MZ)(w.M6)],q.prototype,"popupEnabled",void 0),(0,o._)([(0,y.MZ)({type:S.A,json:{name:"popupInfo",write:!0}})],q.prototype,"popupTemplate",void 0),(0,o._)([(0,y.MZ)({types:x.H,json:{name:"layerDefinition.drawingInfo.renderer"}})],q.prototype,"renderer",void 0),(0,o._)([(0,y.MZ)({json:{read:!1}})],q.prototype,"type",void 0),(0,o._)([(0,y.MZ)({type:Boolean,json:{name:"visibility",write:!0}})],q.prototype,"visible",void 0),q=(0,o._)([(0,h.$)("esri.layers.catalog.CatalogFootprintLayer")],q);const E=q;var Q=r(89078),k=r(40296),B=r(12406),D=r(19502),J=r(31362),G=r(60693),N=r(11270),U=r(37534),$=r(94729),H=r(21617),K=r(78817),z=r(91447),W=r(76350),X=r(38278),Y=r(97015);const ee=(0,W.p)();let te=class extends((0,G.j)((0,_.d)((0,U.f)((0,K.e)((0,b.j)((0,H.J)((0,D.b)((0,N.q)((0,$.A)((0,d.P)((0,J.d)((0,B.p)((0,s.O)(f.A)))))))))))))){constructor(e){super(e),this.dynamicGroupLayer=new P({parent:this}),this.fields=null,this.fieldsIndex=null,this.footprintLayer=new E({parent:this}),this.itemSourceField="cd_itemsource",this.itemTypeField="cd_itemtype",this.layers=new n.A([this.dynamicGroupLayer,this.footprintLayer]),this.source=new Q.default({layer:this}),this.type="catalog"}load(e){const t=null!=e?e.signal:null,r=this.loadFromPortal({supportedTypes:["Feature Service"]},e).catch(p.QP).then((async()=>{var e;if(!this.url)throw new l.A("catalog-layer:missing-url","Catalog layer must be created with a url");if(this.url&&null==this.layerId){const e=await this._fetchFirstValidLayerId(t);if(null==e)throw new l.A("catalog-layer:missing-layerId","There is no Catalog Layer in the service",{service:this.url});this.layerId=e}await this.source.load(),this.source.sourceJSON&&(this.sourceJSON=this.source.sourceJSON,this.read(this.source.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:null===(e=this.portalItem)||void 0===e?void 0:e.portal,url:this.parsedUrl}))})).then((()=>(0,z.VA)(this,"load",e)));return this.addResolvingPromise(r),Promise.resolve(this)}get createQueryVersion(){var e;return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(null!==(e=this._get("createQueryVersion"))&&void 0!==e?e:0)+1}get parsedUrl(){const e=(0,u.An)(this.url);return null!=e&&null!=this.layerId&&(e.path=(0,u.fj)(e.path,this.layerId.toString())),e}createQuery(){var e;const t=new Y.A,r=null===(e=this.capabilities)||void 0===e?void 0:e.query;t.returnGeometry=!0,r&&(t.compactGeometryEnabled=r.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),t.outFields=["*"];const{timeOffset:i,timeExtent:o}=this;return t.timeExtent=null!=i&&null!=o?o.offset(-i.value,i.unit):o||null,t}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var r;return null===(r=this.fieldsIndex.get(e))||void 0===r?void 0:r.domain}async queryFeatures(e,t){var r;const i=await this.load(),o=await i.source.queryFeatures(null!==(r=Y.A.from(e))&&void 0!==r?r:i.createQuery(),t);if(null!==o&&void 0!==o&&o.features)for(const a of o.features)a.layer=a.sourceLayer=i.footprintLayer;return o}async queryObjectIds(e,t){var r;return(await this.load()).source.queryObjectIds(null!==(r=Y.A.from(e))&&void 0!==r?r:this.createQuery(),t)}async queryFeatureCount(e,t){var r;return(await this.load()).source.queryFeatureCount(null!==(r=Y.A.from(e))&&void 0!==r?r:this.createQuery(),t)}async queryExtent(e,t){var r;return(await this.load()).source.queryExtent(null!==(r=Y.A.from(e))&&void 0!==r?r:this.createQuery(),t)}serviceSupportsSpatialReference(e){return this.loaded&&(0,X.D)(this,e)}read(e,t){super.read(e,t);let r=e.footprintLayer;r||"service"!==(null===t||void 0===t?void 0:t.origin)||(r={layerDefinition:{drawingInfo:(0,k.F0)(e.geometryType)}}),this.footprintLayer.read(r,t)}_fetchFirstValidLayerId(e){return(0,a.A)(this.url,{query:(0,i.A)((0,i.A)({f:"json"},this.customParameters),{},{token:this.apiKey}),responseType:"json",signal:e}).then((e=>{var t;const r=e.data;if(r)return Array.isArray(r.layers)?null===(t=r.layers.find((e=>"Catalog Layer"===e.type)))||void 0===t?void 0:t.id:void 0}))}};(0,o._)([(0,y.MZ)({readOnly:!0})],te.prototype,"createQueryVersion",null),(0,o._)([(0,y.MZ)((0,i.A)((0,i.A)({},ee.fields),{},{json:{origins:{service:{name:"fields"}}}}))],te.prototype,"fields",void 0),(0,o._)([(0,y.MZ)(ee.fieldsIndex)],te.prototype,"fieldsIndex",void 0),(0,o._)([(0,y.MZ)({json:{read:!1,write:!1}})],te.prototype,"footprintLayer",void 0),(0,o._)([(0,y.MZ)()],te.prototype,"itemSourceField",void 0),(0,o._)([(0,y.MZ)()],te.prototype,"itemTypeField",void 0),(0,o._)([(0,y.MZ)()],te.prototype,"layers",void 0),(0,o._)([(0,y.MZ)({value:"CatalogLayer",type:["CatalogLayer"]})],te.prototype,"operationalLayerType",void 0),(0,o._)([(0,y.MZ)()],te.prototype,"outFields",void 0),(0,o._)([(0,y.MZ)({readOnly:!0})],te.prototype,"parsedUrl",null),(0,o._)([(0,y.MZ)()],te.prototype,"source",void 0),(0,o._)([(0,y.MZ)({json:{read:!1}})],te.prototype,"type",void 0),te=(0,o._)([(0,h.$)("esri.layers.CatalogLayer")],te);const re=te}}]);
//# sourceMappingURL=4397.b57157ed.chunk.js.map