{"version":3,"file":"static/js/1734.5ae23858.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/libs/i3s/enums.js","../node_modules/@arcgis/core/libs/i3s/I3SModule.js","../node_modules/@arcgis/core/views/3d/layers/SceneLayerWorker.js","../node_modules/@arcgis/core/views/3d/layers/i3s/I3SNode.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nvar n,e;!function(n){n[n.None=0]=\"None\",n[n.Int16=1]=\"Int16\",n[n.Int32=2]=\"Int32\"}(n||(n={})),function(n){n[n.Replace=0]=\"Replace\",n[n.Outside=1]=\"Outside\",n[n.Inside=2]=\"Inside\",n[n.Finished=3]=\"Finished\"}(e||(e={}));export{n as IndexType,e as ModificationType};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as t}from\"../../assets.js\";function e(){return n||(n=new Promise((t=>import(\"../../chunks/i3s.js\").then((t=>t.i)).then((({default:e})=>{const n=e({locateFile:i,onRuntimeInitialized:()=>t(n)});delete n.then})))).catch((t=>{throw t}))),n}function i(e){return t(`esri/libs/i3s/${e}`)}let n;export{e as get};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport e from\"../../../geometry/SpatialReference.js\";import{toFloat64Array as t}from\"../../../geometry/support/DoubleArray.js\";import r from\"../../../geometry/support/MeshGeoreferencedVertexSpace.js\";import o from\"../../../geometry/support/MeshLocalVertexSpace.js\";import{b as n,n as s}from\"../../../chunks/vec3.js\";import{IndexType as i}from\"../../../libs/i3s/enums.js\";import{get as a}from\"../../../libs/i3s/I3SModule.js\";import{NodeIMModificationImpact as f}from\"./i3s/I3SNode.js\";async function c(e){g=await _();const t=[e.geometryBuffer];return{result:E(g,e,t),transferList:t}}async function l(e){g=await _();const t=[e.geometryBuffer],{geometryBuffer:r}=e,o=r.byteLength,n=g._malloc(o),s=new Uint8Array(g.HEAPU8.buffer,n,o);s.set(new Uint8Array(r));const i=g.dracoDecompressPointCloudData(n,s.byteLength);if(g._free(n),i.error.length>0)throw new Error(`i3s.wasm: ${i.error}`);const a=i.featureIds?.length>0?i.featureIds.slice():null,f=i.positions.slice();return a&&t.push(a.buffer),t.push(f.buffer),{result:{positions:f,featureIds:a},transferList:t}}async function u(e){await _(),L(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function m(e){await _(),w(e)}async function y(e){g=await _(),g.setLegacySchema(e.context,e.jsonSchema)}async function p(n){const{localMatrix:s,origin:i,positions:a,vertexSpace:f,localMode:c}=n,l=e.fromJSON(n.inSpatialReference),u=e.fromJSON(n.outSpatialReference);let m;if(\"georeferenced\"===f.type&&null==f.origin){const[{projectBuffer:e},{initializeProjection:t}]=await Promise.all([import(\"../../../geometry/projection/projectBuffer.js\"),import(\"../../../geometry/projection.js\")]);await t(l,u),m=new Float64Array(a.length),e(a,l,0,m,u,0,m.length/3)}else{const e=\"georeferenced\"===f.type?r.fromJSON(f):o.fromJSON(f),{project:n}=await import(\"../../../geometry/support/meshUtils/georeference.js\");m=t(n({positions:a,transform:s?{localMatrix:s}:void 0,vertexSpace:e,inSpatialReference:l,outSpatialReference:u,localMode:c}))}const y=m.length,[p,d,b]=i;for(let e=0;e<y;e+=3)m[e]-=p,m[e+1]-=d,m[e+2]-=b;return{result:{projected:m,original:a},transferList:[m.buffer,a.buffer]}}async function d({normalMatrix:e,normals:t}){const r=new Float32Array(t.length);return n(r,t,e),s(r,r),{result:{transformed:r,original:t},transferList:[r.buffer,t.buffer]}}function b(e){I(e)}let h,g;function w(e){if(!g)return;const t=e.modifications,r=g._malloc(8*t.length),o=new Float64Array(g.HEAPU8.buffer,r,t.length);for(let n=0;n<t.length;++n)o[n]=t[n];g.setModifications(e.context,r,t.length,e.isGeodetic),g._free(r)}function E(e,t,r){const{context:o,localOrigin:n,globalTrafo:s,mbs:a,obbData:f,elevationOffset:c,geometryBuffer:l,geometryDescriptor:u,indexToVertexProjector:m,vertexToRenderProjector:y}=t,p=e._malloc(l.byteLength),d=33,b=e._malloc(d*Float64Array.BYTES_PER_ELEMENT),h=new Uint8Array(e.HEAPU8.buffer,p,l.byteLength);h.set(new Uint8Array(l));const g=new Float64Array(e.HEAPU8.buffer,b,d);S(g,n);let w=g.byteOffset+3*g.BYTES_PER_ELEMENT,E=new Float64Array(g.buffer,w);S(E,s),w+=16*g.BYTES_PER_ELEMENT,E=new Float64Array(g.buffer,w),S(E,a),w+=4*g.BYTES_PER_ELEMENT,f&&(E=new Float64Array(g.buffer,w),S(E,f));const A=u,L={isDraco:!1,isLegacy:!1,color:t.layouts.some((e=>e.some((e=>\"color\"===e.name)))),normal:t.needNormals&&t.layouts.some((e=>e.some((e=>\"normalCompressed\"===e.name)))),uv0:t.layouts.some((e=>e.some((e=>\"uv0\"===e.name)))),uvRegion:t.layouts.some((e=>e.some((e=>\"uvRegion\"===e.name)))),featureIndex:A.featureIndex},I=e.process(o,!!t.obbData,p,h.byteLength,A,L,b,c,m,y,t.normalReferenceFrame);if(e._free(b),e._free(p),I.error.length>0)throw new Error(`i3s.wasm: ${I.error}`);if(I.discarded)return null;const j=I.componentOffsets.length>0?I.componentOffsets.slice():null,_=I.featureIds.length>0?I.featureIds.slice():null,x=I.anchorIds.length>0?Array.from(I.anchorIds):null,M=I.anchors.length>0?Array.from(I.anchors):null,P=I.interleavedVertedData.slice().buffer,U=I.indicesType===i.Int16?new Uint16Array(I.indices.buffer,I.indices.byteOffset,I.indices.byteLength/2).slice():new Uint32Array(I.indices.buffer,I.indices.byteOffset,I.indices.byteLength/4).slice(),O=I.positions.slice(),T=I.positionIndicesType===i.Int16?new Uint16Array(I.positionIndices.buffer,I.positionIndices.byteOffset,I.positionIndices.byteLength/2).slice():new Uint32Array(I.positionIndices.buffer,I.positionIndices.byteOffset,I.positionIndices.byteLength/4).slice(),R={layout:t.layouts[0],interleavedVertexData:P,indices:U,hasColors:I.hasColors,hasModifications:I.hasModifications,positionData:{data:O,indices:T}};return _&&r.push(_.buffer),j&&r.push(j.buffer),r.push(P),r.push(U.buffer),r.push(O.buffer),r.push(T.buffer),{componentOffsets:j,featureIds:_,anchorIds:x,anchors:M,transformedGeometry:R,obb:I.obb}}function A(e){return 0===e?f.Unmodified:1===e?f.PotentiallyModified:2===e?f.Culled:f.Unknown}function L(e){if(!g)return;const{context:t,buffer:r}=e,o=g._malloc(r.byteLength),n=r.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(g.HEAPU8.buffer,o,n),i=new Float64Array(r);s.set(i),g.filterOBBs(t,o,n),i.set(s),g._free(o)}function I(e){g&&0===g.destroy(e)&&(g=null)}function S(e,t){for(let r=0;r<t.length;++r)e[r]=t[r]}async function j(){g||await _()}function _(){return g?Promise.resolve(g):(h||(h=a().then((e=>(g=e,h=null,g)))),h)}const x={transform:(e,t)=>g&&E(g,e,t),destroy:I};export{b as destroyContext,l as dracoDecompressPointCloudData,u as filterObbsForModifications,L as filterObbsForModificationsSync,j as initialize,A as interpretObbModificationResults,c as process,p as project,y as setLegacySchema,m as setModifications,w as setModificationsSync,x as test,d as transformNormals};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{fromValues as e}from\"../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";import{f as i}from\"../../../../chunks/sphere.js\";import{invalidateMbs as n}from\"./I3SUtil.js\";import{ElevationRange as t}from\"../../support/ElevationRange.js\";class s extends t{constructor(e,n){super(NaN,NaN),this.id=e,this.serviceMbsInIndexSR=n,this.serviceMbsInRenderSR=i(0,0,0,-1)}invalidateServiceBVsInRenderSR(){n(this.serviceMbsInRenderSR),this.serviceObbInRenderSR?.invalidate()}shareServiceBVsInRenderSRWith(e){this.serviceObbInRenderSR=e.serviceObbInRenderSR,this.serviceMbsInRenderSR=e.serviceMbsInRenderSR}}var o,r,a,d,c;!function(e){e[e.Unmodified=0]=\"Unmodified\",e[e.Culled=1]=\"Culled\",e[e.NotChecked=2]=\"NotChecked\"}(o||(o={})),function(e){e[e.Unmodified=0]=\"Unmodified\",e[e.PotentiallyModified=1]=\"PotentiallyModified\",e[e.Culled=2]=\"Culled\",e[e.Unknown=3]=\"Unknown\",e[e.NotChecked=4]=\"NotChecked\"}(r||(r={}));class h extends s{constructor(i,n,t,s,o,d,c,h,l,u){super(i,t),this.index=n,this.childCount=s,this.level=o,this.resources=d,this.version=c,this.lodMetric=h,this.maxError=l,this.numFeatures=u,this.failed=!1,this.cacheState=a.Unknown,this.vertexCount=0,this.memory=0,this.childrenLoaded=0,this.hasModifications=!1,this.imModificationImpact=r.NotChecked,this.elevationAgnosticBoundingVolume=e(0,0,0,-1)}invalidateServiceBVsInRenderSR(){super.invalidateServiceBVsInRenderSR(),this.elevationAgnosticBoundingVolume[3]=-1}}!function(e){e[e.Unknown=0]=\"Unknown\",e[e.Uncached=1]=\"Uncached\",e[e.Cached=2]=\"Cached\"}(a||(a={})),function(e){e[e.None=0]=\"None\",e[e.MaxScreenThreshold=1]=\"MaxScreenThreshold\",e[e.ScreenSpaceRelative=2]=\"ScreenSpaceRelative\",e[e.RemovedFeatureDiameter=3]=\"RemovedFeatureDiameter\",e[e.DistanceRangeFromDefaultCamera=4]=\"DistanceRangeFromDefaultCamera\"}(d||(d={})),function(e){e[e.Hole=0]=\"Hole\",e[e.Leaf=1]=\"Leaf\"}(c||(c={}));class l{constructor(e,i,n,t){this.nodeHasLOD=e,this.isChosen=i,this.lodLevel=n,this.version=t}}export{a as CacheState,d as LodMetric,h as Node,s as NodeBase,o as NodeFilterImpact,r as NodeIMModificationImpact,c as NodeState,l as NodeTraversalState};\n"],"names":["n","e","None","Int16","Int32","Replace","Outside","Inside","Finished","i","t","concat","async","c","g","_","geometryBuffer","result","E","transferList","l","_i$featureIds","r","o","byteLength","_malloc","s","Uint8Array","HEAPU8","buffer","set","dracoDecompressPointCloudData","_free","error","length","Error","a","featureIds","slice","f","positions","push","u","L","m","w","y","setLegacySchema","context","jsonSchema","p","localMatrix","origin","vertexSpace","localMode","fromJSON","inSpatialReference","outSpatialReference","type","projectBuffer","initializeProjection","Promise","all","Float64Array","project","transform","d","b","projected","original","_ref","normalMatrix","normals","Float32Array","transformed","I","h","modifications","setModifications","isGeodetic","localOrigin","globalTrafo","mbs","obbData","elevationOffset","geometryDescriptor","indexToVertexProjector","vertexToRenderProjector","BYTES_PER_ELEMENT","S","byteOffset","A","isDraco","isLegacy","color","layouts","some","name","normal","needNormals","uv0","uvRegion","featureIndex","process","normalReferenceFrame","discarded","j","componentOffsets","x","anchorIds","Array","from","M","anchors","P","interleavedVertedData","U","indicesType","Uint16Array","indices","Uint32Array","O","T","positionIndicesType","positionIndices","R","layout","interleavedVertexData","hasColors","hasModifications","positionData","data","transformedGeometry","obb","Unmodified","PotentiallyModified","Culled","Unknown","filterOBBs","destroy","resolve","then","default","locateFile","onRuntimeInitialized","catch","constructor","super","NaN","this","id","serviceMbsInIndexSR","serviceMbsInRenderSR","invalidateServiceBVsInRenderSR","_this$serviceObbInRen","serviceObbInRenderSR","invalidate","shareServiceBVsInRenderSRWith","NotChecked","index","childCount","level","resources","version","lodMetric","maxError","numFeatures","failed","cacheState","vertexCount","memory","childrenLoaded","imModificationImpact","elevationAgnosticBoundingVolume","Uncached","Cached","MaxScreenThreshold","ScreenSpaceRelative","RemovedFeatureDiameter","DistanceRangeFromDefaultCamera","Hole","Leaf","nodeHasLOD","isChosen","lodLevel"],"sourceRoot":""}