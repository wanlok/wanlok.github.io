"use strict";(self.webpackChunkwanlok_component_react=self.webpackChunkwanlok_component_react||[]).push([[7567],{72317:(e,t,n)=>{n.d(t,{C:()=>s});var o=n(75543),i=n(61751),a=n(23241);class s extends i.w{constructor(e){super({...e,constraint:new o.i7(e.targetPoint)})}get hints(){return[new a._(this.targetPoint,this.isDraped,this.domain)]}}},77567:(e,t,n)=>{n.r(t),n.d(t,{FeatureCollectionSnappingSource:()=>f});var o=n(35143),i=n(91967),a=n(56002),s=n(50346),r=n(68134),c=n(46053),l=(n(81806),n(76460),n(47249),n(85842)),u=n(12482),d=n(9730),p=n(18153),h=n(35961),g=n(52583),y=n(69963);let f=class extends i.A{get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,n=null!=e&&"3d"===e.type;if(!n||"subtype-group"===t.type)return(0,h.n)();return(0,h.n)(n,{elevationInfo:t.elevationInfo,alignPointsInFeatures:async(n,o)=>(await(0,s.qr)(e.whenLayerView(t),o)).elevationAlignPointsInFeatures(n,o)})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&"3d"===e.type&&"subtype-group"!==this.layerSource.layer.type;return(0,g.z)(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&"3d"===e.type&&"subtype-group"!==t.type?(0,y.H)(this._symbologySnappingSupported,(async(n,o)=>{const i=await e.whenLayerView(t);return(0,s.Te)(o),i.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},o)})):(0,y.H)()}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&"3d"===e.type&&"subtype-group"!==t.type&&(e.whenLayerView(t).then((e=>this._layerView3D=e)),this.addHandles([e.elevationProvider.on("elevation-change",(e=>{let{context:n}=e;const{elevationInfo:o}=t;(0,u.Up)(n,o)&&this._snappingElevationAligner.notifyElevationSourceChange()})),(0,r.wB)((()=>t.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),r.Vh),(0,r.wB)((()=>{var e;return null!=this._layerView3D?null===(e=this._layerView3D.processor)||void 0===e?void 0:e.renderer:null}),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),r.Vh),(0,r.on)((()=>{var e;return null===(e=this._layerView3D)||void 0===e?void 0:e.layer}),["edits","apply-edits","graphic-update"],(()=>this._symbologySnappingFetcher.notifySymbologyChange()))]))}constructor(e){super(e),this.view=null,this._layerView3D=null,this._memoizedMakeGetGroundElevation=(0,a.B)(p.p)}refresh(){}async fetchCandidates(e,t){var n,o;const{layer:i}=this.layerSource,a=i.source;if(null===a||void 0===a||!a.querySnapping)return[];const r=(0,d.HN)(i),c=(0,d.nf)(e,null!==(n=null===(o=this.view)||void 0===o?void 0:o.type)&&void 0!==n?n:"2d",r),l=await a.querySnapping(c,{signal:t});(0,s.Te)(t);const u=e.coordinateHelper.spatialReference,h=await this._snappingElevationAligner.alignCandidates(l.candidates,u,t);(0,s.Te)(t);const g=await this._symbologySnappingFetcher.fetch(h,t);(0,s.Te)(t);const y=0===g.length?h:[...h,...g],f=this._snappingElevationFilter.filter(c,y),v=this._memoizedMakeGetGroundElevation(this.view,u);return f.map((e=>(0,p.$)(e,v)))}};(0,o._)([(0,c.MZ)({constructOnly:!0})],f.prototype,"layerSource",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],f.prototype,"view",void 0),(0,o._)([(0,c.MZ)()],f.prototype,"_snappingElevationAligner",null),(0,o._)([(0,c.MZ)()],f.prototype,"_snappingElevationFilter",null),(0,o._)([(0,c.MZ)()],f.prototype,"_symbologySnappingFetcher",null),(0,o._)([(0,c.MZ)()],f.prototype,"_layerView3D",void 0),(0,o._)([(0,c.MZ)()],f.prototype,"_symbologySnappingSupported",null),f=(0,o._)([(0,l.$)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],f)},18153:(e,t,n)=>{n.d(t,{$:()=>c,p:()=>l});var o=n(23862),i=n(80794),a=n(9876),s=n(72317);function r(e){let{x:t,y:n,z:i}=e;return(0,o.fA)(t,n,null!==i&&void 0!==i?i:0)}function c(e,t){switch(e.type){case"edge":return e.draped?new i.X({edgeStart:r(e.start),edgeEnd:r(e.end),targetPoint:r(e.target),objectId:e.objectId,getGroundElevation:t}):new a.z({edgeStart:r(e.start),edgeEnd:r(e.end),targetPoint:r(e.target),objectId:e.objectId,isDraped:!1});case"vertex":return new s.C({targetPoint:r(e.target),objectId:e.objectId,isDraped:!1})}}function l(e,t){return null!=e&&"3d"===e.type?(n,o)=>e.elevationProvider.getElevation(n,o,0,t,"ground"):()=>null}},35961:(e,t,n)=>{n.d(t,{n:()=>c});n(81806);var o=n(53521),i=n(87663),a=n(50346),s=n(31633),r=n(59097);function c(){let e=arguments.length>1?arguments[1]:void 0;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){const{elevationInfo:t,alignPointsInFeatures:n}=e;return new u(t,n)}return new l}class l{async alignCandidates(e,t,n){return e}notifyElevationSourceChange(){}}class u{constructor(e,t){this._elevationInfo=e,this._alignPointsInFeatures=t,this._alignmentsCache=new o.q(1024),this._cacheVersion=0}async alignCandidates(e,t,n){const o=this._elevationInfo;return null==o||"absolute-height"!==o.mode||o.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,n):(this._alignAbsoluteElevationCandidates(e,t,o),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}_alignAbsoluteElevationCandidates(e,t,n){const{offset:o,unit:i}=n;if(null==o)return;const a=(0,s.G9)(t),c=o*((0,r.Ao)(null!==i&&void 0!==i?i:"meters")/a);for(const s of e)switch(s.type){case"edge":s.start.z+=c,s.end.z+=c;continue;case"vertex":s.target.z+=c;continue}}async _alignComputedElevationCandidates(e,t,n){const o=new Map;for(const a of e)(0,i.tE)(o,a.objectId,h).push(a);const[s,r,c]=this._prepareQuery(o,t),l=await this._alignPointsInFeatures(s,n);if((0,a.Te)(n),c!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t,n);this._applyCacheAndResponse(s,l,r);const{drapedObjectIds:u,failedObjectIds:d}=l,p=[];for(const i of e){const{objectId:e}=i;u.has(e)&&"edge"===i.type&&(i.draped=!0),d.has(e)||p.push(i)}return p}_prepareQuery(e,t){const n=[],o=[];for(const[i,a]of e){const e=[];for(const t of a)this._addToQueriesOrCachedResult(i,t.target,e,o),"edge"===t.type&&(this._addToQueriesOrCachedResult(i,t.start,e,o),this._addToQueriesOrCachedResult(i,t.end,e,o));0!==e.length&&n.push({objectId:i,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:n},o,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,n,o){const i=p(e,t),a=this._alignmentsCache.get(i);null==a?n.push(t):o.push(new d(t,a))}_applyCacheAndResponse(e,t,n){let{elevations:o,drapedObjectIds:i,failedObjectIds:a}=t;for(const c of n)c.apply();let s=0;const r=this._alignmentsCache;for(const{objectId:c,points:l}of e.pointsInFeatures){if(a.has(c)){s+=l.length;continue}const e=!i.has(c);for(const t of l){const n=p(c,t),i=o[s++];t.z=i,e&&r.put(n,i,1)}}}}class d{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function p(e,t){let{x:n,y:o,z:i,spatialReference:a}=t;return"".concat(e,"-").concat(n,"-").concat(o,"-").concat(null!==i&&void 0!==i?i:0,"}-wkid:").concat(null===a||void 0===a?void 0:a.wkid)}function h(){return[]}},52583:(e,t,n)=>{n.d(t,{z:()=>s});n(81806);class o{filter(e,t){return t}notifyElevationSourceChange(){}}class i{filter(e,t){const{point:n,distance:o}=e,{z:i}=n;if(null==i)return t;if(0===t.length)return t;const s=function(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(o),r=this._updateCandidatesTo3D(t,n,s).filter(a);return r.sort(l),r}_updateCandidatesTo3D(e,t,n){for(const o of e)switch(o.type){case"edge":r(o,t,n);continue;case"vertex":c(o,t,n);continue}return e}}function a(e){return e.distance<=1}function s(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new i:new o}function r(e,t,n){let{x:o,y:i,z:a}=n;const{start:s,end:r,target:c}=e;e.draped||function(e,t,n,o){const i=o.x-n.x,a=o.y-n.y,s=o.z-n.z,r=i*i+a*a+s*s,c=(t.x-n.x)*i+(t.y-n.y)*a+s*(t.z-n.z),l=Math.min(1,Math.max(0,c/r)),u=n.x+i*l,d=n.y+a*l,p=n.z+s*l;e.x=u,e.y=d,e.z=p}(c,t,s,r);const l=(t.x-c.x)/o,u=(t.y-c.y)/i,d=(t.z-c.z)/a;e.distance=Math.sqrt(l*l+u*u+d*d)}function c(e,t,n){let{x:o,y:i,z:a}=n;const{target:s}=e,r=(t.x-s.x)/o,c=(t.y-s.y)/i,l=(t.z-s.z)/a,u=Math.sqrt(r*r+c*c+l*l);e.distance=u}function l(e,t){return e.distance-t.distance}},69963:(e,t,n)=>{n.d(t,{H:()=>r});n(81806);var o=n(53084),i=n(53521),a=n(50346),s=n(88685);function r(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new l(arguments.length>1?arguments[1]:void 0):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}class l{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new i.q(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const n=[],i=[],s=this._candidatesCache;for(const a of e){const e=u(a),t=s.get(e);if(t)for(const n of t)i.push((0,o.o8)(n));else n.push(a),s.put(e,[],1)}if(0===n.length)return i;const r=this._cacheVersion,{candidates:c,sourceCandidateIndices:l}=await this._getSymbologyCandidates(n,t);if((0,a.Te)(t),r!==this._cacheVersion)return this.fetch(e,t);const d=[],{length:p}=c;for(let a=0;a<p;++a){const e=c[a],t=u(n[l[a]]),i=s.get(t);i.push(e),s.put(t,i,i.length),d.push((0,o.o8)(e))}return i.concat(d)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function u(e){switch(e.type){case"vertex":{var t;const{objectId:n,target:o}=e,i="".concat(n,"-vertex-").concat(o.x,"-").concat(o.y,"-").concat(null!==(t=o.z)&&void 0!==t?t:0);return(0,s.Wm)(i).toString()}case"edge":{var n,o;const{objectId:t,start:i,end:a}=e,r="".concat(t,"-edge-").concat(i.x,"-").concat(i.y,"-").concat(null!==(n=i.z)&&void 0!==n?n:0,"-to-").concat(a.x,"-").concat(a.y,"-").concat(null!==(o=a.z)&&void 0!==o?o:0);return(0,s.Wm)(r).toString()}default:return""}}}}]);
//# sourceMappingURL=7567.f57de4e4.chunk.js.map